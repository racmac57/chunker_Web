# SCRPA_Code_Editor

**User:**   
**Created:**   
**Updated:**   
**Exported:** 10/27/2025 10:39  

## Prompt:
review the attached M Code and seprate each step in an outline format

SCRPA\_Time\_M\_Code.docx

## Response:
Below is an outline of the M code from the provided document, separating each step with a brief description of its purpose based on the Power Query transformations. * * *

### M Code Outline

1. **Source**
    *   Loads an Excel workbook using a parameter (Parameter1), with headers included. 2. **Sheet1\_Sheet**
    *   Selects the "Sheet1" worksheet from the loaded workbook. 3. **Promoted Headers**
    *   Promotes the first row of the table to column headers, treating all scalar values as headers. 4. **Added Custom**
    *   Adds a column "CASE\_NUMBER\_LENGTH" calculating the length of the "Case Number" column using Text.Length. 5. **Filtered Rows**
    *   Filters rows where "CASE\_NUMBER\_LENGTH" equals 9. 6. **Changed Type**
    *   Converts specified columns to appropriate data types:
        *   Incident Date: Date
        *   Incident Date\_Between: Date
        *   Report Date: Date
        *   Report Time: Time
        *   Incident Time\_Between: Time
        *   Incident Time: Time
7. **Reordered Columns**
    *   Reorders columns to a specified sequence for better organization. 8. **Added Custom1**
    *   Adds a column "INC\_DATE" using conditional logic:
        *   If "Incident Date" is null, uses "Incident Date\_Between" or "Report Date"; otherwise, uses "Incident Date". 9. **Added Custom2**
    *   Adds a column "INC\_TIME" using conditional logic:
        *   If "Incident Time" is null, uses "Incident Time\_Between" or "Report Time"; otherwise, uses "Incident Time". 10. **Changed Type1**
    *   Converts "INC\_DATE" to Date and "INC\_TIME" to Time data types. 11. **Inserted Start of Hour**
    *   Adds a column "Start of Hour" calculating the start of the hour for "INC\_TIME" using Time.StartOfHour. 12. **Inserted Year**
    *   Adds a column "Year" extracting the year from "INC\_DATE" using Date.Year. 13. **Reordered Columns1**
    *   Reorders columns to include newly added "Year" column. 14. **Inserted Month Name**
    *   Adds a column "Month Name" extracting the month name from "INC\_DATE" using Date.MonthName. 15. **Inserted Week of Year**
    *   Adds a column "Week of Year" calculating the week number of the year for "INC\_DATE" using Date.WeekOfYear. 16. **Inserted Week of Month**
    *   Adds a column "Week of Month" calculating the week number within the month for "INC\_DATE" using Date.WeekOfMonth. 17. **Inserted Day**
    *   Adds a column "Day" extracting the day of the month from "INC\_DATE" using Date.Day. 18. **Inserted Day of Year**
    *   Adds a column "Day of Year" calculating the day number of the year for "INC\_DATE" using Date.DayOfYear. 19. **Inserted Day Name**
    *   Adds a column "Day Name" extracting the day of the week name from "INC\_DATE" using Date.DayOfWeekName. 20. **Inserted Merged Column**
    *   Adds a column "INC\_DATE\_AND\_TIME" combining "INC\_DATE" and "INC\_TIME" into a single text string with a space separator. 21. **Reordered Columns2**
    *   Reorders columns to prioritize "INC\_DATE\_AND\_TIME" and other key fields. 22. **Changed Type2**
    *   Converts "INC\_DATE\_AND\_TIME" to a DateTime data type. 23. **Reordered Columns3**
    *   Reorders columns again to adjust the placement of "Start of Hour". 24. **Extracted Text Before Delimiter**
    *   Modifies "Incident Type\_1", "Incident Type\_2", and "Incident Type\_3" by extracting text before the delimiter " - 2C:". 25. **Added Custom3**
    *   Adds a column "ALL\_INCIDENTS" combining non-null values from "Incident Type\_1", "Incident Type\_2", and "Incident Type\_3" with a comma separator. 26. **Reordered Columns4**
    *   Reorders columns to include "ALL\_INCIDENTS" near the incident type columns. 27. **Trimmed Text**
    *   Trims whitespace from the "FullAddress" column. 28. **Cleaned Text**
    *   Cleans the "FullAddress" column to remove non-printable characters. 29. **Inserted Text Before Delimiter**
    *   Adds a column "Text Before Delimiter" extracting text from "FullAddress" before the delimiter ", ". 30. **Inserted Text Before Delimiter1**
    *   Adds a column "Text Before Delimiter.1" extracting text from "Text Before Delimiter" before a space. 31. **Changed Type3**
    *   Converts "Text Before Delimiter.1" to Int64 (numeric) type. 32. **Replaced Errors**
    *   Replaces errors in "Text Before Delimiter.1" with null values. 33. **Added Custom4**
    *   Adds a column "BLOCK" (attempted but later removed) to create a block address format, abbreviating street names and calculating block numbers. 34. **Removed Columns**
    *   Removes the "BLOCK" column added in the previous step. 35. **Renamed Columns**
    *   Renames "Text Before Delimiter" to "LOCATION" and "Text Before Delimiter.1" to "St#". 36. **Added Custom5**
    *   Adds a new "BLOCK" column (attempted but later removed) with similar logic to format addresses with block numbers. 37. **Renamed Columns1**
    *   Renames "LOCATION" to "Location". 38. **Removed Columns1**
    *   Removes the "BLOCK" column added in "Added Custom5". 39. **BLOCK**
    *   Adds a permanent "BLOCK" column formatting addresses with abbreviated street names and block numbers based on "St#". 40. **TIME\_OF\_DAY**
    *   Adds a column "TIME\_OF\_DAY" categorizing "Start of Hour" into time periods (e.g., "Early Morning (00:00-03:59)"). 41. **Trimmed Text1**
    *   Trims whitespace from the "Narrative" column. 42. **Cleaned Text1**
    *   Cleans the "Narrative" column to remove non-printable characters. 43. **Changed Type4**
    *   Converts "Total Value Stolen" and "Total Value Recover" to Currency data type. 44. **Trimmed Text2**
    *   Trims whitespace from vehicle-related columns ("Reg State 1", "Model1", "Registration 1", "Make1", "Registration 2", "Reg State 2", "Model2", "Make2"). 45. **Cleaned Text2**
    *   Cleans vehicle-related columns to remove non-printable characters. 46. **Uppercased Text**
    *   Converts vehicle-related columns to uppercase. 47. **Capitalized Each Word**
    *   Capitalizes each word in the "Reviewed By" column using Text.Proper. 48. **Added Custom6**
    *   Adds a column "VEHICLE1" combining vehicle details for the first vehicle (Reg State, Registration, Make, Model) with conditional formatting. 49. **Added Custom7**
    *   Adds a column "VEHICLE2" combining details for both vehicles (Vehicle 1 and Vehicle 2) with conditional formatting, separated by " | " if both exist. 50. **Removed Columns2**
    *   Removes the "VEHICLE1" column. 51. **Renamed Columns2**
    *   Renames "VEHICLE2" to "VEHICLE". 52. **Duplicated Column**
    *   Duplicates the "Narrative" column as "Narrative - Copy". 53. **Added Custom8**
    *   Adds a column "Custom" extracting text related to "suspect" from the "Narrative" column, combining segments after splitting by "suspect". 54. **Renamed Columns3**
    *   Renames the "Custom" column to "Suspect". 55. **Reordered Columns5**
    *   Reorders columns to include "Suspect" and "Narrative - Copy". 56. **Added Custom9**
    *   Adds a column "Amount Taken" extracting dollar amounts from the "Narrative" column by splitting on "$" and combining valid segments. 57. **Reordered Columns6**
    *   Reorders columns to include "Amount Taken". 58. **Renamed Columns4**
    *   Renames "Amount Taken" to "TOTAL\_STOLEN\_AMOUNT". 59. **Trimmed Text3**
    *   Trims whitespace from the "Suspect" column. 60. **Cleaned Text3**
    *   Cleans the "Suspect" column to remove non-printable characters. 61. **Reordered Columns7**
    *   Reorders columns to adjust the placement of key fields like "Suspect" and "TOTAL\_STOLEN\_AMOUNT". 62. **Replaced Value**
    *   Replaces "June" with "February" in the "Month Name" column. 63. **Replaced Value1**
    *   Replaces the date 2017-06-20 with 2025-02-20 in the "INC\_DATE" column. 64. **Removed Duplicates**
    *   Removes duplicate rows based on the "Case Number" column. 65. **REPORT\_CYCLE**
    *   Adds a column "REPORT\_CYCLE" assigning a cycle (C01-C14) and week (W01-W26) based on "INC\_DATE" ranges for 2024-2025, formatted as "C##W##". 66. **Reordered Columns8**
    *   Reorders columns to include "REPORT\_CYCLE" near the end. 67. **Added Custom11**
    *   Adds a column "Custom" categorizing "Start of Hour" into time-of-day labels (e.g., "00:00-03:59 Early Morning"). 68. **Renamed Columns5**
    *   Renames the "Custom" column to "TOD". 69. **Reordered Columns9**
    *   Reorders columns to prioritize "TOD" and adjust column sequence. 70. **Sorted Rows**
    *   Sorts the table by "INC\_DATE" in descending order. 71. **Renamed Columns6**
    *   Renames "Narrative - Copy" to "Notes". 72. **Sorted Rows1**
    *   Sorts the table by "INC\_DATE" in ascending order. 73. **Replaced Value2**
    *   Replaces "Friday" with "Fri" in the "Day Name" column. 74. **Replaced Value3**
    *   Replaces "Monday" with "Mon" in the "Day Name" column. 75. **Replaced Value4**
    *   Replaces "Tuesday" with "Tue" in the "Day Name" column.