let
    // === STEP 1: Load RMS Excel File from Folder ===
    Source = Folder.Files("C:\Users\carucci_r\OneDrive - City of Hackensack\_LawSoft_EXPORT\RMS\MVA"),
    FilteredFiles = Table.SelectRows(Source, each Text.EndsWith([Extension], ".xlsx")),
    FirstFile = FilteredFiles{0}[Content],
    ExcelData = Excel.Workbook(FirstFile, null, true),
    SheetData = ExcelData{[Item="Sheet1", Kind="Sheet"]}[Data],
    PromotedHeaders = Table.PromoteHeaders(SheetData, [PromoteAllScalars=true]),

    // === STEP 2: Clean Column Names ===
    FixedColumns = Table.RenameColumns(PromotedHeaders, {{"Fulladdress", "FullAddress"}, {"Case Number", "CaseNumber"}}, MissingField.Ignore),
    CurrentColumns = Table.ColumnNames(FixedColumns),
    PascalCaseNames = List.Transform(CurrentColumns, each 
        if Text.Contains(_, " ") then 
            Text.Combine(
                List.Transform(
                    Text.SplitAny(_, " _"), 
                    each Text.Upper(Text.Start(_, 1)) & Text.Lower(Text.End(_, Text.Length(_) - 1))
                ), 
                ""
            ) 
        else _
    ),
    RenamePairs = List.Zip({CurrentColumns, PascalCaseNames}),
    RenamedTable = Table.RenameColumns(FixedColumns, RenamePairs, MissingField.Ignore),

    // === STEP 3: Enrich Incident Data ===
    ReplacedNulls = Table.TransformColumns(RenamedTable, {{"CaseNumber", each if _ = null then "Null" else Text.From(_), type text}}),
    AddedCaseNumberLength = Table.AddColumn(ReplacedNulls, "CaseNumberLength", each Text.Length([CaseNumber])),
    
    // Enhanced date handling with multiple fallbacks
    AddedIncDate = Table.AddColumn(AddedCaseNumberLength, "IncDate", each 
        try (
            if [IncidentDate] <> null then Date.From([IncidentDate]) 
            else if [IncidentDateBetween] <> null then Date.From([IncidentDateBetween]) 
            else if [ReportDate] <> null then Date.From([ReportDate]) 
            else null
        ) otherwise null, type nullable date
    ),
    
    // Enhanced time handling with multiple fallbacks
    AddedIncTime = Table.AddColumn(AddedIncDate, "IncTime", each 
        try (
            if [IncidentTime] <> null then Time.From(DateTime.Time([IncidentTime])) 
            else if [IncidentTimeBetween] <> null then Time.From(DateTime.Time([IncidentTimeBetween])) 
            else if [ReportTime] <> null then Time.From(DateTime.Time([ReportTime])) 
            else null
        ) otherwise null, type nullable time
    ),
    
    // Add hour analysis
    AddedStartOfHour = Table.AddColumn(AddedIncTime, "StartOfHour", each 
        if [IncTime] <> null then Time.StartOfHour([IncTime]) else null, type nullable time
    ),
    
    AddedHourOfDay = Table.AddColumn(AddedStartOfHour, "HourOfDay", each 
        if [IncTime] <> null then Time.Hour([IncTime]) else null, type nullable number
    ),
    
    // Enhanced time of day categories for traffic analysis
    AddedTimeOfDay = Table.AddColumn(AddedHourOfDay, "TimeOfDay", each 
        let t = try Time.From([IncTime]) otherwise null 
        in if t = null then "Unknown"
        else if t < #time(4,0,0) then "Late Night (00:00–03:59)"
        else if t < #time(6,0,0) then "Early Morning (04:00–05:59)"
        else if t < #time(9,0,0) then "Morning Rush (06:00–08:59)"
        else if t < #time(12,0,0) then "Morning (09:00–11:59)"
        else if t < #time(15,0,0) then "Afternoon (12:00–14:59)"
        else if t < #time(18,0,0) then "Evening Rush (15:00–17:59)"
        else if t < #time(21,0,0) then "Evening (18:00–20:59)"
        else "Night (21:00–23:59)", type text
    ),
    
    // Enhanced location analysis
    AddedBlock = Table.AddColumn(AddedTimeOfDay, "Block", each 
        if [FullAddress] <> null then 
            try Text.BeforeDelimiter([FullAddress], " ", 1) 
            otherwise [FullAddress] 
        else null, type nullable text
    ),
    
    // Street name extraction
    AddedStreet = Table.AddColumn(AddedBlock, "Street", each 
        if [FullAddress] <> null then 
            try Text.AfterDelimiter([FullAddress], " ", 0) 
            otherwise [FullAddress] 
        else null, type nullable text
    ),
    
    // Enhanced incident type concatenation
    AddedAllIncidents = Table.AddColumn(AddedStreet, "AllIncidents", each 
        let
            type1 = if [IncidentType1] <> null then [IncidentType1] else "",
            type2 = if [IncidentType2] <> null then " - " & [IncidentType2] else "",
            type3 = if [IncidentType3] <> null then " - " & [IncidentType3] else ""
        in
            Text.Trim(type1 & type2 & type3), type text
    ),
    
    // Enhanced temporal analysis
    AddedYear = Table.AddColumn(AddedAllIncidents, "Year", each 
        if [IncDate] <> null then Date.Year([IncDate]) else null, type nullable number
    ),
    
    AddedMonth = Table.AddColumn(AddedYear, "Month", each 
        if [IncDate] <> null then Date.Month([IncDate]) else null, type nullable number
    ),
    
    AddedMonthName = Table.AddColumn(AddedMonth, "MonthName", each 
        if [IncDate] <> null then Date.MonthName([IncDate]) else null, type nullable text
    ),
    
    AddedQuarter = Table.AddColumn(AddedMonthName, "Quarter", each 
        if [IncDate] <> null then "Q" & Text.From(Date.QuarterOfYear([IncDate])) else null, type nullable text
    ),
    
    AddedSeason = Table.AddColumn(AddedQuarter, "Season", each 
        if [IncDate] <> null then
            let m = Date.Month([IncDate])
            in if List.Contains({3,4,5}, m) then "Spring" 
            else if List.Contains({6,7,8}, m) then "Summer" 
            else if List.Contains({9,10,11}, m) then "Fall" 
            else "Winter"
        else null, type nullable text
    ),
    
    // Enhanced day analysis
    AddedDayOfWeek = Table.AddColumn(AddedSeason, "DayOfWeek", each 
        if [IncDate] <> null then Date.DayOfWeekName([IncDate]) else null, type nullable text
    ),
    
    AddedDayType = Table.AddColumn(AddedDayOfWeek, "DayType", each 
        if [IncDate] <> null then
            if Date.DayOfWeek([IncDate], Day.Monday) >= 5 then "Weekend" else "Weekday"
        else null, type nullable text
    ),
    
    // Traffic-specific analysis columns
    AddedIsWeekendEvening = Table.AddColumn(AddedDayType, "IsWeekendEvening", each 
        if [DayType] = "Weekend" and [IncTime] <> null then
            if Time.Hour([IncTime]) >= 18 or Time.Hour([IncTime]) <= 2 then true else false
        else false, type logical
    ),
    
    AddedIsRushHour = Table.AddColumn(AddedIsWeekendEvening, "IsRushHour", each 
        if [DayType] = "Weekday" and [IncTime] <> null then
            let hour = Time.Hour([IncTime])
            in (hour >= 6 and hour <= 9) or (hour >= 15 and hour <= 18)
        else false, type logical
    ),
    
    // Date calculations for reporting
    AddedDaysAgo = Table.AddColumn(AddedIsRushHour, "DaysAgo", each 
        if [IncDate] <> null then 
            Duration.Days(DateTime.Date(DateTime.LocalNow()) - [IncDate])
        else null, type nullable number
    ),
    
    // Fiscal year (assuming July 1 start)
    AddedFiscalYear = Table.AddColumn(AddedDaysAgo, "FiscalYear", each 
        if [IncDate] <> null then
            if Date.Month([IncDate]) >= 7 then 
                Date.Year([IncDate]) + 1 
            else 
                Date.Year([IncDate])
        else null, type nullable number
    )
in
    AddedFiscalYear