This is because the script source file path (the .py) is either:

Not set (was never added), or

Broken (file was moved or renamed). üîß Solution: Re-link the .py Script to the Toolbox
1. Open ArcGIS Pro and your project. Open your TimeSCRPATemplet.aprx. 2. In the Catalog Pane, right-click on:
CrimeAutomationTools.atbx ‚Üí Click New ‚Üí Script. 3. Fill out the New Script dialog:
Name: WeeklyCrimeReport

Label: Weekly Crime Report

Script File: Click the folder icon near ‚ÄúScript File‚Äù and browse to:

C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py
4. Click OK to save the new script tool. ‚úÖ Recommended Final Setup for Both Desktop and Laptop
To avoid these path issues in the future:

üìÇ Folder Structure (Use Across Both Machines):
C:\Users\<YourUser>\OneDrive - City of Hackensack\
    |_ _Hackensack_Data_Repository\
        |_ GIS_Tools\
            |_ Scripts\
                |_ weekly_crime_report.py
            |_ CrimeAutomationTools.atbx
        |_ 7Day_28Day_Cycle_20250414.xlsx
    |_ 25_SCRPA\
        |_ TIME_Based\
            |_ TimeSCRPATemplet\
                |_ TimeSCRPATemplet.aprx
üìå Make sure:
All the above files are marked "Always Keep on this Device" in OneDrive. ArcGIS Pro project and script refer to consistent local paths (not cloud-only). ‚úÖ Automation with Windows Task Scheduler
Save a Batch File (e.g., run_report.bat):

@echo off
call "C:\Program Files\ArcGIS\Pro\bin\Python\scripts\propy.bat" "C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py"
Create Scheduled Task:

Open Task Scheduler

Create Task ‚Üí Name it: Weekly Crime Report Automation

Trigger: Weekly or Specific Date

Action: Start a program ‚Üí point to run_report.bat

üß† Pro Tip:
Always reopen your .aprx and test the tool manually first after re-linking. If sharing the .atbx or .aprx between devices, ensure the same file structure exists on both machines. Would you like a sample .bat file or a guide on creating a Task Scheduler trigger? You said:
Uploaded image
Uploaded image
Uploaded image
is this the correct recommended folder Structure? The file explore has the .py script saved at path:
"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py"
Yet the ToolBox path in the New Script has 
"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx"

i clicked ok and "Weekly Crime Report" appears below CrimeAutomationTolls.atbx. running the script returns this message:

Weekly Crime Report
=====================
Tool Path

C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx\WeeklyCrimeReport
=====================
Parameters

=====================
Messages

Start Time: Monday, May 5, 2025 2:51:17 PM
Succeeded at Monday, May 5, 2025 2:51:17 PM (Elapsed Time: 0.46 seconds)

I right clicked "Weekly Crime Report" and edited the script. I pasted in 
import arcpy
import pandas as pd
from datetime import datetime
import os

# Set paths
csv_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\Refrence\TimeSCRPT\DateRelated\7Day_28Day_Cycle_20250414.csv"
export_root = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\Reports"
project_path = r"C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx"
project = arcpy.mp.ArcGISProject(project_path)
map_obj = project.listMaps()[0]  # Assumes one map in project

# Load cycle control table
cycle_df = pd.read_csv(csv_path)
if not any(cycle_df['Is_Due'] == True):
    raise ValueError("No cycle is marked as 'Is_Due = True' in the cycle table.") current_cycle = cycle_df[cycle_df['Is_Due'] == True].iloc[0]

# Extract dates and naming info
seven_day_start = pd.to_datetime(current_cycle['7_Day_Start']).strftime('%Y-%m-%d')
seven_day_end = pd.to_datetime(current_cycle['7_Day_End']).strftime('%Y-%m-%d')
twenty_eight_day_start = pd.to_datetime(current_cycle['28_Day_Start']).strftime('%Y-%m-%d')
twenty_eight_day_end = pd.to_datetime(current_cycle['28_Day_End']).strftime('%Y-%m-%d')
ytd_start = '2024-12-31'
report_name = current_cycle['Report_Name']
report_due_date = pd.to_datetime(current_cycle['Report_Due_Date']).strftime('%Y_%m_%d')

# Output folder
report_folder = os.path.join(export_root, f"{report_name}_{report_due_date}")
os.makedirs(report_folder, exist_ok=True)

# Keyword filters
keywords_by_crime = {
    "Burglary - Auto": ['auto'],
    "Burglary - Comm & Res": ['residence', 'commercial'],
    "Robbery": ['robbery'],
    "Sexual Offenses": ['sexual'],
    "MV Theft": ['motor vehicle theft']
}

# SQL definition builders
def build_sql(start_date, end_date, keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{start_date}' AND calldate <= date '{end_date}' AND disposition LIKE '%report%' AND ({clause})"

def build_sql_ytd(keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{ytd_start}' AND disposition LIKE '%report%' AND ({clause})"

# Apply queries
layer_query_mapping = {}
for crime, keywords in keywords_by_crime.items():
    layer_query_mapping[f"{crime} 7-Day"] = build_sql(seven_day_start, seven_day_end, keywords)
    layer_query_mapping[f"{crime} 28-Day"] = build_sql(twenty_eight_day_start, twenty_eight_day_end, keywords)
    layer_query_mapping[f"{crime} YTD"] = build_sql_ytd(keywords)

for lname, sql in layer_query_mapping.items():
    lyr = map_obj.listLayers(lname)[0]
    lyr.definitionQuery = sql

layout = [lyt for lyt in project.listLayouts() if lyt.name == "Crime Report Legend"][0]
legend_list = layout.listElements("LEGEND_ELEMENT")
legend_names = [l.name for l in legend_list]
arcpy.AddMessage(f"Legend elements found: {legend_names}")
legend = next((l for l in legend_list if l.name.strip().lower() == "mainlegend"), None)

if legend is None:
    raise ValueError(f"Legend element 'MainLegend' not found in layout. Found: {legend_names}")

crime_types = list(keywords_by_crime.keys())
base_layers = [
    "City Boundaries",
    "World Street Map (Night)",
    "Any Optional Context Layers"
]

for crime in crime_types:
    visible_layers = []
    for lyr in map_obj.listLayers():
        if crime in lyr.name:
            lyr.visible = True
            visible_layers.append(lyr)
            if "7-Day" in lyr.name:
                lyr.transparency = 0
            elif "28-Day" in lyr.name:
                lyr.transparency = 30
            else:
                lyr.transparency = 60
        elif any(base in lyr.name for base in base_layers):
            lyr.visible = True
        else:
            lyr.visible = False

    # Zoom using extent of all visible features
    extent = None
    for lyr in visible_layers:
        if lyr.supports("DATASOURCE"):
            with arcpy.da.SearchCursor(lyr, ["SHAPE@"]) as cursor:
                for row in cursor:
                    geom = row[0]
                    if extent:
                        extent = arcpy.Extent(
                            min(extent.XMin, geom.extent.XMin),
                            min(extent.YMin, geom.extent.YMin),
                            max(extent.XMax, geom.extent.XMax),
                            max(extent.YMax, geom.extent.YMax)
                        )
                    else:
                        extent = geom.extent
    if extent:
        map_obj.defaultCamera.setExtent(extent)

    # Export
    output_pdf = os.path.join(report_folder, f"{crime.replace(' ', '_')}_{report_name}_{report_due_date}.pdf")
    layout.exportToPDF(output_pdf)

project.save()
arcpy.AddMessage(f"Reports exported to: {report_folder}")

I saved, refreashed the toolbox and ran again. I received this error:

Weekly Crime Report
=====================
Tool Path

C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx\WeeklyCrimeReport
=====================
Parameters

=====================
Messages

Start Time: Monday, May 5, 2025 2:55:57 PM
ÔªøTraceback (most recent call last):
Ôªø  File "C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx\WeeklyCrimeReport.tool\tool.script.execute.py", line 9, in <module>
Ôªø  File "C:\Program Files\ArcGIS\Pro\Resources\ArcPy\arcpy\_mp.py", line 1500, in __init__
Ôªø    self._arc_object = arcgisscripting._mapping.ArcGISProject(*gp_fixargs((aprx_path,), True))
Ôªø                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ÔªøOSError: C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx

Failed script Weekly Crime Report...
Failed to execute (WeeklyCrimeReport). Failed at Monday, May 5, 2025 2:55:59 PM (Elapsed Time: 2.15 seconds)
ChatGPT said:
Thanks for your thorough documentation and clear setup. Based on the path issue and the OSError you received:

OSError: C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx

The script is trying to open a .aprx project file at C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx, but that file does not exist at that location‚Äîlikely because the automation has been moved to a different machine or folder. ‚úÖ Fix the OSError and ensure the automation runs:
1. ‚úÖ Update the Project Reference in Your Script
Since you‚Äôre now using the project file at:

C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx
Replace this line in your script:

project = arcpy.mp.ArcGISProject(project_path)
With:

project_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"
project = arcpy.mp.ArcGISProject(project_path)
Or, if you're executing the script from within the .aprx, you can alternatively use:

project = arcpy.mp.ArcGISProject("CURRENT")
‚Ä¶but this only works if the .aprx is open in ArcGIS Pro at runtime. üìÇ File Structure Recommendation
Yes, your current structure is logical and well-organized. Here‚Äôs the validated recommended structure:

GIS_Tools\
‚îÇ
‚îú‚îÄ‚îÄ Scripts\
‚îÇ   ‚îî‚îÄ‚îÄ weekly_crime_report.py
‚îÇ
‚îú‚îÄ‚îÄ CrimeAutomationTools.atbx
Ensure this path to your .py script is correct in the Script Properties inside the toolbox:

C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py
‚úÖ Final Checklist to Ensure Script Runs from Toolbox
Fix the hardcoded project path (as above). Ensure script path is saved in the .atbx ‚Üí open the toolbox > right-click the tool > Properties > Execution tab > browse to your .py file. Test the script inside ArcGIS Pro. Confirm all required files (data & layers) are marked "Always keep on this device" via right-click in File Explorer. Would you like a ready-to-paste version of the corrected script with the updated project path? You said:
I update the script file to this:

import arcpy
import pandas as pd
from datetime import datetime
import os

# Set paths
csv_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\Refrence\TimeSCRPT\DateRelated\7Day_28Day_Cycle_20250414.csv"
export_root = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\Reports"
project_path = r"C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx"
project_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"

The path to the .py file is:

"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py" 
project = arcpy.mp.ArcGISProject(project_path)
map_obj = project.listMaps()[0]  # Assumes one map in project

# Load cycle control table
cycle_df = pd.read_csv(csv_path)
if not any(cycle_df['Is_Due'] == True):
    raise ValueError("No cycle is marked as 'Is_Due = True' in the cycle table.") current_cycle = cycle_df[cycle_df['Is_Due'] == True].iloc[0]

# Extract dates and naming info
seven_day_start = pd.to_datetime(current_cycle['7_Day_Start']).strftime('%Y-%m-%d')
seven_day_end = pd.to_datetime(current_cycle['7_Day_End']).strftime('%Y-%m-%d')
twenty_eight_day_start = pd.to_datetime(current_cycle['28_Day_Start']).strftime('%Y-%m-%d')
twenty_eight_day_end = pd.to_datetime(current_cycle['28_Day_End']).strftime('%Y-%m-%d')
ytd_start = '2024-12-31'
report_name = current_cycle['Report_Name']
report_due_date = pd.to_datetime(current_cycle['Report_Due_Date']).strftime('%Y_%m_%d')

# Output folder
report_folder = os.path.join(export_root, f"{report_name}_{report_due_date}")
os.makedirs(report_folder, exist_ok=True)

# Keyword filters
keywords_by_crime = {
    "Burglary - Auto": ['auto'],
    "Burglary - Comm & Res": ['residence', 'commercial'],
    "Robbery": ['robbery'],
    "Sexual Offenses": ['sexual'],
    "MV Theft": ['motor vehicle theft']
}

# SQL definition builders
def build_sql(start_date, end_date, keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{start_date}' AND calldate <= date '{end_date}' AND disposition LIKE '%report%' AND ({clause})"

def build_sql_ytd(keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{ytd_start}' AND disposition LIKE '%report%' AND ({clause})"

# Apply queries
layer_query_mapping = {}
for crime, keywords in keywords_by_crime.items():
    layer_query_mapping[f"{crime} 7-Day"] = build_sql(seven_day_start, seven_day_end, keywords)
    layer_query_mapping[f"{crime} 28-Day"] = build_sql(twenty_eight_day_start, twenty_eight_day_end, keywords)
    layer_query_mapping[f"{crime} YTD"] = build_sql_ytd(keywords)

for lname, sql in layer_query_mapping.items():
    lyr = map_obj.listLayers(lname)[0]
    lyr.definitionQuery = sql

layout = [lyt for lyt in project.listLayouts() if lyt.name == "Crime Report Legend"][0]
legend_list = layout.listElements("LEGEND_ELEMENT")
legend_names = [l.name for l in legend_list]
arcpy.AddMessage(f"Legend elements found: {legend_names}")
legend = next((l for l in legend_list if l.name.strip().lower() == "mainlegend"), None)

if legend is None:
    raise ValueError(f"Legend element 'MainLegend' not found in layout. Found: {legend_names}")

crime_types = list(keywords_by_crime.keys())
base_layers = [
    "City Boundaries",
    "World Street Map (Night)",
    "Any Optional Context Layers"
]

for crime in crime_types:
    visible_layers = []
    for lyr in map_obj.listLayers():
        if crime in lyr.name:
            lyr.visible = True
            visible_layers.append(lyr)
            if "7-Day" in lyr.name:
                lyr.transparency = 0
            elif "28-Day" in lyr.name:
                lyr.transparency = 30
            else:
                lyr.transparency = 60
        elif any(base in lyr.name for base in base_layers):
            lyr.visible = True
        else:
            lyr.visible = False

    # Zoom using extent of all visible features
    extent = None
    for lyr in visible_layers:
        if lyr.supports("DATASOURCE"):
            with arcpy.da.SearchCursor(lyr, ["SHAPE@"]) as cursor:
                for row in cursor:
                    geom = row[0]
                    if extent:
                        extent = arcpy.Extent(
                            min(extent.XMin, geom.extent.XMin),
                            min(extent.YMin, geom.extent.YMin),
                            max(extent.XMax, geom.extent.XMax),
                            max(extent.YMax, geom.extent.YMax)
                        )
                    else:
                        extent = geom.extent
    if extent:
        map_obj.defaultCamera.setExtent(extent)

    # Export
    output_pdf = os.path.join(report_folder, f"{crime.replace(' ', '_')}_{report_name}_{report_due_date}.pdf")
    layout.exportToPDF(output_pdf)

project.save()
arcpy.AddMessage(f"Reports exported to: {report_folder}")
ChatGPT said:
Thanks for sharing the updated script. You're almost there, but there's one important correction needed in your script: you accidentally defined project_path twice, one after the other ‚Äî the first path is being overwritten immediately by the second. ‚úÖ Here's the corrected section:
Replace this block:

project_path = r"C:\GIS_Projects\SCRPA_Weekly_Crime_Report.aprx"
project_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"
project = arcpy.mp.ArcGISProject(project_path)
With just this:

project_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"
project = arcpy.mp.ArcGISProject(project_path)
This ensures that the script is pointing to the correct .aprx without confusion. ‚úÖ Optional Enhancement (Add Project Exists Check)
To make the script more robust (especially if moved across machines):

if not os.path.exists(project_path):
    raise FileNotFoundError(f"Project file not found: {project_path}")
project = arcpy.mp.ArcGISProject(project_path)
Once you‚Äôve corrected the path duplication and saved the .py file, run the tool again inside ArcGIS Pro. It should now find the .aprx and execute without the OSError. Would you like me to help you wrap this up with Task Scheduler setup steps for daily or weekly automation? You said:
update the script including "Optional Enhancement (Add Project Exists Check"
ChatGPT said:
Your script now includes a project existence check to ensure the APRX path is valid before execution. This improves reliability‚Äîespecially when run from Task Scheduler or multiple machines. Let me know if you'd like to add error logging or email notifications next. Provide Feedback | View Changes | Contribute. You said:
I saved the new version in the the "weekly_crime_report.py" path:
"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py"

what do I do now to get the script to work in the templet project? ChatGPT said:
To get the script working inside the TimeSCRPATemplet ArcGIS Pro project, follow these steps to link it to your toolbox (CrimeAutomationTools.atbx) and ensure it runs smoothly:

‚úÖ Step-by-Step Integration of weekly_crime_report.py into the Template Project
1. Ensure Script Path Is Correct and Accessible
You‚Äôve saved the updated script here:

C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\Scripts\weekly_crime_report.py
Ensure this location:

Is available offline

Remains unchanged after setup

Is not moved or renamed after linking to the toolbox

2. Update Your Toolbox to Use the Script
Open ArcGIS Pro and load your TimeSCRPATemplet.aprx project. In the Catalog Pane, right-click on CrimeAutomationTools.atbx ‚Üí click Edit. If you already created the WeeklyCrimeReport tool:

Right-click the tool ‚Üí Edit. Under Execution > Script File, click the folder icon and browse to the saved .py file at the path above. Click OK to save and close the script tool properties. This binds the Python script file to the toolbox tool. 3. Test the Script Tool
In ArcGIS Pro, double-click WeeklyCrimeReport from the toolbox. If parameters are defined, fill them in. If not, just run it. Check the Geoprocessing Messages pane to confirm the tool:

Executes the .aprx project

Exports the crime maps

Logs messages like Legend elements found: ['MainLegend']

4. Optional: Automate with Task Scheduler
If everything works:

You can now schedule it to run using Task Scheduler with a .bat file that points to python.exe and your script. Let me know when you‚Äôre ready for this step. ‚úÖ You‚Äôre Done! At this point:

Your script is correctly linked to the toolbox. The template project (.aprx) loads as expected. You can now run the full automation from ArcGIS Pro or schedule it. Would you like me to walk you through setting up Task Scheduler next? You said:
Uploaded image
Step 2, #2: I don't see Edit (see attachment 1). I have "Weekly Crime Report" as a script, when i click edit the script appears, I don't see 

TimeSCRPATemplet.atbx path:
C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.atbx

CrimeAutomationTools.atbx path:
C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx

Weekly Crime Report (Script) Path: 
C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\GIS_Tools\CrimeAutomationTools.atbx\WeeklyCrimeReport

Script:
import arcpy
import pandas as pd
from datetime import datetime
import os
# Set paths
csv_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_Hackensack_Data_Repository\Refrence\TimeSCRPT\DateRelated\7Day_28Day_Cycle_20250414.csv"
export_root = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\Reports"
project_path = r"C:\Users\carucci_r\OneDrive - City of Hackensack\_25_SCRPA\TIME_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"
# Check if project file exists
if not os.path.exists(project_path):
    raise FileNotFoundError(f"Project file not found: {project_path}")
project = arcpy.mp.ArcGISProject(project_path)
map_obj = project.listMaps()[0]  # Assumes one map in project
# Load cycle control table
cycle_df = pd.read_csv(csv_path)
if not any(cycle_df['Is_Due'] == True):
    raise ValueError("No cycle is marked as 'Is_Due = True' in the cycle table.") current_cycle = cycle_df[cycle_df['Is_Due'] == True].iloc[0]
# Extract dates and naming info
seven_day_start = pd.to_datetime(current_cycle['7_Day_Start']).strftime('%Y-%m-%d')
seven_day_end = pd.to_datetime(current_cycle['7_Day_End']).strftime('%Y-%m-%d')
twenty_eight_day_start = pd.to_datetime(current_cycle['28_Day_Start']).strftime('%Y-%m-%d')
twenty_eight_day_end = pd.to_datetime(current_cycle['28_Day_End']).strftime('%Y-%m-%d')
ytd_start = '2024-12-31'
report_name = current_cycle['Report_Name']
report_due_date = pd.to_datetime(current_cycle['Report_Due_Date']).strftime('%Y_%m_%d')
# Output folder
report_folder = os.path.join(export_root, f"{report_name}_{report_due_date}")
os.makedirs(report_folder, exist_ok=True)
# Keyword filters
keywords_by_crime = {
    "Burglary - Auto": ['auto'],
    "Burglary - Comm & Res": ['residence', 'commercial'],
    "Robbery": ['robbery'],
    "Sexual Offenses": ['sexual'],
    "MV Theft": ['motor vehicle theft']
}
# SQL definition builders
def build_sql(start_date, end_date, keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{start_date}' AND calldate <= date '{end_date}' AND disposition LIKE '%report%' AND ({clause})"
def build_sql_ytd(keywords):
    clause = " OR ".join([f"calltype LIKE '%{kw}%'" for kw in keywords])
    return f"calldate >= date '{ytd_start}' AND disposition LIKE '%report%' AND ({clause})"
# Apply queries
layer_query_mapping = {}
for crime, keywords in keywords_by_crime.items():
    layer_query_mapping[f"{crime} 7-Day"] = build_sql(seven_day_start, seven_day_end, keywords)
    layer_query_mapping[f"{crime} 28-Day"] = build_sql(twenty_eight_day_start, twenty_eight_day_end, keywords)
    layer_query_mapping[f"{crime} YTD"] = build_sql_ytd(keywords)
for lname, sql in layer_query_mapping.items():
    lyr = map_obj.listLayers(lname)[0]
    lyr.definitionQuery = sql
layout = [lyt for lyt in project.listLayouts() if lyt.name == "Crime Report Legend"][0]
legend_list = layout.listElements("LEGEND_ELEMENT")
legend_names = [l.name for l in legend_list]
arcpy.AddMessage(f"Legend elements found: {legend_names}")
legend = next((l for l in legend_list if l.name.strip().lower() == "mainlegend"), None)
if legend is None:
    raise ValueError(f"Legend element 'MainLegend' not found in layout. Found: {legend_names}")
crime_types = list(keywords_by_crime.keys())
base_layers = [
    "City Boundaries",
    "World Street Map (Night)",
    "Any Optional Context Layers"
]
for crime in crime_types:
    visible_layers = []
    for lyr in map_obj.listLayers():
        if crime in lyr.name:
            lyr.visible = True
            visible_layers.append(lyr)
            if "7-Day" in lyr.name:
                lyr.transparency = 0
            elif "28-Day" in lyr.name:
                lyr.transparency = 30
            else:
                lyr.transparency = 60
        elif any(base in lyr.name for base in base_layers):
            lyr.visible = True
        else:
            lyr.visible = False
    # Zoom using extent of all visible features
    extent = None
    for lyr in visible_layers:
        if lyr.supports("DATASOURCE"):
            with arcpy.da.SearchCursor(lyr, ["SHAPE@"]) as cursor:
                for row in cursor:
                    geom = row[0]
                    if extent:
                        extent = arcpy.Extent(
                            min(extent.XMin, geom.extent.XMin),
                            min(extent.YMin, geom.extent.YMin),
                            max(extent.XMax, geom.extent.XMax),
                            max(extent.YMax, geom.extent.YMax)
                        )
                    else:
                        extent = geom.extent
    if extent:
        map_obj.defaultCamera.setExtent(extent)
    # Export
    output_pdf = os.path.join(report_folder, f"{crime.replace(' ', '_')}_{report_name}_{report_due_date}.pdf")
    layout.exportToPDF(output_pdf)
project.save()
arcpy.AddMessage(f"Reports exported to: {report_folder}")

When I click edit on the script the code comes up in the Notebook app. Can I change the default app to edit the script from note pad to NotePad++? ChatGPT said:
Yes, you can absolutely change the default editor for .py files from Notepad to Notepad++ (or any preferred text editor). Here's how to set that up on your work computer:

‚úÖ Change Default Python Editor to Notepad++
Option 1: From File Explorer
Right-click any .py file (like weekly_crime_report.py). Choose ‚ÄúOpen with‚Äù > ‚ÄúChoose another app‚Äù. Click More apps, then scroll and click ‚ÄúLook for another app on this PC‚Äù. Browse to the Notepad++ executable (usually located at:
C:\Program Files\Notepad++\notepad++.exe)

Check ‚ÄúAlways use this app to open .py files‚Äù, then click OK.

Option 2: Set File Association via Settings
Open Settings > Apps > Default apps. Scroll down and select ‚ÄúChoose default apps by file type‚Äù. Scroll to .py and click the current default app (likely Notepad). Select Notepad++ from the list (or browse to it as above). üß© How This Helps
Changing the default ensures that:

Any time you click Edit on a script from ArcGIS Pro or File Explorer, it opens in Notepad++. Syntax highlighting, auto-indentation, and tab spacing are improved ‚Äî making script maintenance much easier. Would you like help customizing Notepad++ to better support Python (e.g., enabling tabs, linting, or auto-save)? You said:
Uploaded image
\[media pointer="file-service://file-SSQn5ZXb94siua6mjwx2yD"]
Step 2, #2: I don't see Edit (see attachment 1). I have "Weekly Crime Report" as a script, when i click edit the script appears, I don't see

TimeSCRPATemplet.atbx path:
C:\Users\carucci\_r\OneDrive - City of Hackensack\_25\_SCRPA\TIME\_Based\TimeSCRPATemplet\TimeSCRPATemplet.atbx

CrimeAutomationTools.atbx path:
C:\Users\carucci\_r\OneDrive - City of Hackensack\_Hackensack\_Data\_Repository\GIS\_Tools\CrimeAutomationTools.atbx

Weekly Crime Report (Script) Path:
C:\Users\carucci\_r\OneDrive - City of Hackensack\_Hackensack\_Data\_Repository\GIS\_Tools\CrimeAutomationTools.atbx\WeeklyCrimeReport

Script:
import arcpy
import pandas as pd
from datetime import datetime
import os

# Set paths

csv\_path = r"C:\Users\carucci\_r\OneDrive - City of Hackensack\_Hackensack\_Data\_Repository\Refrence\TimeSCRPT\DateRelated\7Day\_28Day\_Cycle\_20250414.csv"
export\_root = r"C:\Users\carucci\_r\OneDrive - City of Hackensack\_25\_SCRPA\TIME\_Based\Reports"
project\_path = r"C:\Users\carucci\_r\OneDrive - City of Hackensack\_25\_SCRPA\TIME\_Based\TimeSCRPATemplet\TimeSCRPATemplet.aprx"

# Check if project file exists

if not os.path.exists(project\_path):
raise FileNotFoundError(f"Project file not found: {project\_path}")
project = arcpy.mp.ArcGISProject(project\_path)
map\_obj = project.listMaps()\[0]  # Assumes one map in project

# Load cycle control table

cycle\_df = pd.read\_csv(csv\_path)
if not any(cycle\_df\['Is\_Due'] == True):
raise ValueError("No cycle is marked as 'Is\_Due = True' in the cycle table.")