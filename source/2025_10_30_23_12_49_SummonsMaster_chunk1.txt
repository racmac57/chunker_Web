[IMPORT] pandas, numpy, re, calendar, sys, warnings, logging
[FROM IMPORT] from datetime import datetime, date
[FROM IMPORT] from dateutil.relativedelta import relativedelta
[FROM IMPORT] from pathlib import Path
[FROM IMPORT] from textwrap import dedent
[CONSTANT]: BADGE_PAREN_RE
[CONSTANT]: BADGE_HASH_RE
[CONSTANT]: PARKING_ORDS
[CONSTANT]: PARKING_ORDS_NORM
[CONSTANT]: RE_TITLE39
[CONSTANT]: RE_PARKING_DESC
[CONSTANT]: RE_SPECIAL_DESC
[CONSTANT]: RE_MOVING_DESC
[CONSTANT]: SOURCE_FILES
[CONSTANT]: ASSIGNMENT_FILE
[CONSTANT]: OUTPUT_FILE
[CONSTANT]: ARCHIVE_MONTHLY
[CONSTANT]: LOG_FILE
[VARIABLE]: log

[FUNCTION]: rolling_window()

[FUNCTION]: detect_encoding(p)

[FUNCTION]: detect_delimiter(p, enc)

[FUNCTION]: parse_date(s)

[FUNCTION]: classify_type(code, desc)
   [Description] Return 'P' (Parking), 'M' (Moving), or 'C' (Special Complaint)
    using current rules, with robust ...

[FUNCTION]: classify_types_vectorized(df)
   [Description] Vectorized classifier. Produces:
      - TYPE: 'P' (Parking), 'M' (Moving), 'C' (Special Complaint)
...

[FUNCTION]: load_assignment(path, logger)
   [Description] Load Assignment_Master_V2 as a tidy DataFrame keyed on PADDED_BADGE_NUMBER,
    with only the column...

[FUNCTION]: enrich_assign_vectorized(df, assign_df, logger)
   [Description] Vectorized enrichment:
      - Normalizes PADDED_BADGE_NUMBER on the fact DF
      - Single left-mer...

[FUNCTION]: load_csv(path)

[FUNCTION]: create_historical_records(df_historical)
   [Description] Create individual records from historical aggregated data...

[FUNCTION]: load_file(path)

[FUNCTION]: enforce_peo_rule(df, logger)
   [Description] If WG3 is PEO or CLASS I, officers never issue moving summons. Force TYPE to 'P' and mark PEO_RU...

[FUNCTION]: apply_officer_display_fallback(df)
   [Description] Ensure OFFICER_DISPLAY_NAME is never blank and contains at most one badge tag. If OFFICER_DISPLA...

[FUNCTION]: add_quality(df)

[FUNCTION]: write_outputs_summary(all_df, overall, by_officer, by_officer_month, output_file, start, end)
   [Description] Write summary markdown and changelog files...

[FUNCTION]: main()
[VARIABLE]: today
[VARIABLE]: prev_y
[VARIABLE]: prev_m
[VARIABLE]: end_day
[VARIABLE]: end_d
[VARIABLE]: start_d
[VARIABLE]: c_raw
[VARIABLE]: d_raw
[VARIABLE]: c_norm
[CONSTANT]: PARKING_ORDS
[CONSTANT]: PARKING_ORDS_NORM
[VARIABLE]: d_norm
[VARIABLE]: parking_keywords
[VARIABLE]: special_keywords
[VARIABLE]: moving_keywords
[VARIABLE]: statute
[VARIABLE]: statute_ns
[VARIABLE]: desc_up
[VARIABLE]: n
[VARIABLE]: out_type
[VARIABLE]: out_reason
[VARIABLE]: mask_parking_code
[VARIABLE]: mask_parking_desc
[VARIABLE]: m2
[VARIABLE]: mask_special
[VARIABLE]: m3
[VARIABLE]: mask_title39
[VARIABLE]: m4
[VARIABLE]: mask_moving_desc
[VARIABLE]: m5
[VARIABLE]: m6
[VARIABLE]: usecols
[VARIABLE]: right
[VARIABLE]: merged

[PRIVATE METHOD]: _coalesce(dst, src)
[VARIABLE]: merged
[VARIABLE]: enc
[VARIABLE]: delim
[VARIABLE]: df
[VARIABLE]: records
[VARIABLE]: wg3_u
[VARIABLE]: preflip_mask
[VARIABLE]: preflip_count
[VARIABLE]: flipped_count
[VARIABLE]: disp
[VARIABLE]: raw
[VARIABLE]: badge
[VARIABLE]: use_raw_mask
[VARIABLE]: disp
[VARIABLE]: disp

[PRIVATE METHOD]: _append_once(name, b)
[VARIABLE]: base
[VARIABLE]: now
[VARIABLE]: ym
[VARIABLE]: ts
[VARIABLE]: patrol
[VARIABLE]: counts_all
[VARIABLE]: counts_patrol
[VARIABLE]: peo_swaps
[VARIABLE]: reason_counts
[VARIABLE]: patrol_movers
[VARIABLE]: patrol_parkers
[VARIABLE]: source_files
[VARIABLE]: summary_path
[VARIABLE]: summary
[VARIABLE]: changelog_path
[VARIABLE]: changes
[VARIABLE]: assign_df
[VARIABLE]: frames
[VARIABLE]: all_df
[VARIABLE]: all_df
[VARIABLE]: all_df
[VARIABLE]: all_df
[VARIABLE]: reason_counts
[VARIABLE]: all_df
[VARIABLE]: preflip_candidates
[VARIABLE]: all_df
[VARIABLE]: all_df
[VARIABLE]: peo_audit
[VARIABLE]: patrol
[VARIABLE]: overall
[VARIABLE]: by_officer
[VARIABLE]: by_officer_month
[VARIABLE]: output_file
[VARIABLE]: s
[VARIABLE]: path
[VARIABLE]: df
[VARIABLE]: dstv
[VARIABLE]: srcv
[VARIABLE]: no_match
[VARIABLE]: count
[VARIABLE]: violation_type
[VARIABLE]: month_year
[VARIABLE]: year
[VARIABLE]: month
[VARIABLE]: year_month_key
[VARIABLE]: df
[VARIABLE]: name
[VARIABLE]: b
[VARIABLE]: p
[VARIABLE]: df
[VARIABLE]: df
[VARIABLE]: sample
[VARIABLE]: stamp
[VARIABLE]: out2
[VARIABLE]: badge_raw
[VARIABLE]: issue_date
[VARIABLE]: out

[FUNCTION]: get_col(primary, fallback, default_val)
[VARIABLE]: out
[VARIABLE]: df
[VARIABLE]: sample
[VARIABLE]: df
[VARIABLE]: timestamp
[VARIABLE]: output_file