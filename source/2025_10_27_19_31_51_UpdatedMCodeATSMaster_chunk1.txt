let
    // Load workbook from parameter
    Source = Excel.Workbook(Parameter1, null, true),
    Sheet = Source{[Item="Sheet1",Kind="Sheet"]}[Data],

    // Skip the top 4 rows (titles/headers)
    SkippedRows = Table.Skip(Sheet, 4),

    // Promote the 5th row as headers
    PromotedHeaders = Table.PromoteHeaders(SkippedRows, [PromoteAllScalars=true]),

    // Remove last 3 rows (footers)
    TrimmedBottom = Table.RemoveLastN(PromotedHeaders, 3),

    // Rename first column to "Badge Number"
    RenamedFirstCol = Table.RenameColumns(TrimmedBottom, {{Table.ColumnNames(TrimmedBottom){0}, "Badge Number"}}),

    // Normalize headers (remove LF, tabs, trim)
    CleanedHeaders = Table.RenameColumns(
        RenamedFirstCol,
        List.Transform(
            Table.ColumnNames(RenamedFirstCol),
            each { _, Text.Trim(Text.Replace(Text.Replace(_, "#(lf)", ""), "#(tab)", "")) }
        )
    ),

    FixedHeaders = Table.RenameColumns(CleanedHeaders, List.Select({
        {"OFFICERNAME", "Officer Name"},
        {"TICKETNUMBER", "Ticket Number"},
        {"ISSUEDATE", "Issue Date"},
        {"VIOLATIONNUMBER", "Violation Number"},
        {"DISPOSITIONDATE", "Disposition Date"},
        {"PAYMENTDATE", "Payment Date"},
        {"ASSESSEDAMOUNT", "Assessed Amount"},
        {"FINE AMOUNT", "Fine Amount"},
        {"COST AMOUNT", "Cost Amount"},
        {"MISC AMOUNT", "Misc Amount"},
        {"TOTAL PAIDAMOUNT", "Total Paid Amount"},
        {"CITY COSTAMOUNT", "City Cost Amount"},
        {"FINDCD", "Find CD"}
    }, each List.Contains(Table.ColumnNames(CleanedHeaders), _{0}))),

    // Filter valid badge numbers (4-digit)
    Filtered = Table.SelectRows(FixedHeaders, each try Text.Length(Text.From([Badge Number])) = 4 otherwise false),

    // Clean numeric columns
    NumericCols = {"Find Cd", "Assessed Amount", "Fine Amount", "Cost Amount", "Misc Amount", "Total Paid Amount", "City Cost Amount"},
    CleanedNumeric = List.Accumulate(NumericCols, Filtered, (state, col) =>
        if List.Contains(Table.ColumnNames(state), col) then
            Table.TransformColumns(state, {{col, each try Number.FromText(Text.Select(Text.From(_), {"0".."9", "."})) otherwise null}})
        else state
    ),

    // Apply type transformations   
    ChangedTypes = Table.TransformColumnTypes(CleanedNumeric, {
        {"Badge Number", type text},
        {"Officer Name", type text},
        {"Ticket Number", type text},
        {"Issue Date", type date},
        {"Violation Number", type text},
        {"Disposition Date", type date},
        {"Payment Date", type date},
        {"Assessed Amount", Currency.Type},
        {"Fine Amount", Currency.Type},
        {"Cost Amount", Currency.Type},
        {"Misc Amount", Currency.Type},
        {"Total Paid Amount", Currency.Type},
        {"City Cost Amount", Currency.Type}
    }),

    // Add year/month/day metadata
    AddYear = Table.AddColumn(ChangedTypes, "Year", each Date.Year([Issue Date]), Int64.Type),
    AddMonth = Table.AddColumn(AddYear, "Month", each Date.Month([Issue Date]), Int64.Type),
    AddMMMYY = Table.AddColumn(AddMonth, "MMM-YY", each Text.PadStart(Text.From(Date.Month([Issue Date])), 2, "0") & "-" & Text.End(Text.From(Date.Year([Issue Date])), 2), type text),
    AddDayName = Table.AddColumn(AddMMMYY, "Day Name", each Date.DayOfWeekName([Issue Date]), type text),

    // âœ… COMMA ADDED HERE
    // Merge with Members
    Merged = Table.NestedJoin(AddDayName, {"Badge Number"}, Members, {"BADGE#"}, "PLATOONS", JoinKind.LeftOuter),

    // Expand merged Members table
    Expanded = Table.ExpandTableColumn(Merged, "PLATOONS", {"PATROL_MEMBER", "ASSIGNMENT", "ASSIGNMENT2", "RANK"}, {"Name", "Assignment", "Assignment2", "Rank"}),

    // Add Squad and Platoon information
    WithPlatoon = Table.AddColumn(Expanded, "Platoon", each try Text.Start([Assignment], 1) otherwise null, type text),
    WithSquad = Table.AddColumn(WithPlatoon, "Squad", each [Assignment], type text),
    WithUnitGroup = Table.AddColumn(WithSquad, "Unit Group", each 
        if Text.StartsWith([Assignment], "A") then "Platoon A" else 
        if Text.StartsWith([Assignment], "B") then "Platoon B" else 
        if [Assignment] = "TRF" then "Traffic" else
        if [Assignment] = "CSB" then "Crime Suppression Bureau" else
        if [Assignment] = "DET" then "Detectives" else
        if [Assignment] = "HACSOC" then "Special Operations" else
        if [Assignment] = "STA" then "School Threat Assessment" else null, type text)

in
    WithUnitGroup