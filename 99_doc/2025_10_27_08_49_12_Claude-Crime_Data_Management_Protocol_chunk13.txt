**Proper folder structure** (crime-specific organization)

**SCRPA Complete Integration - Charts, Maps, and Statistics**

````python
# ðŸ•’ 2025-07-01-17-00-00
# SCRPA_Complete_Integration/scrpa_complete_system
# Author: R. A. Carucci
# Purpose: Complete SCRPA system with charts, maps, statistics, and proper folder structure

import os
import sys
import logging
import time
import glob
import shutil
from datetime import datetime, date
import arcpy

# Import your existing working modules
try:
    from config import (
        get_crime_type_folder, get_7day_period_dates, CRIME_FOLDER_MAPPING, 
        POWERPOINT_TEMPLATES, CRIME_TYPES, get_correct_folder_name, 
        get_standardized_filename, get_output_folder
    )
    from map_export import export_maps
    from chart_export import export_chart
    from incident_table_automation import export_incident_table_data_with_autofit, create_incident_table_placeholder
    from scrpa_statistical_fixed import generate_statistical_exports_fixed
    print("âœ… All modules imported successfully")
except ImportError as e:
    print(f"âŒ Module import failed: {e}")
    sys.exit(1)

def run_complete_scrpa_system(report_date_str=None, generate_all=True):
    """
    Run the complete SCRPA system with proper folder structure
    
    Args:
        report_date_str (str): Date in YYYY_MM_DD format
        generate_all (bool): Generate all components (maps, charts, tables, stats)
    
    Returns:
        bool: True if successful
    """
    start_time = time.time()
    
    if report_date_str is None:
        report_date_str = date.today().strftime("%Y_%m_%d")
    
    print(f"\nðŸš€ SCRPA COMPLETE SYSTEM")
    print("=" * 60)
    print(f"Report Date: {report_date_str}")
    print(f"Generate All Components: {generate_all}")
    
    try:
        # Parse report date
        report_date = datetime.strptime(report_date_str, "%Y_%m_%d").date()
        
        # Create main output folder with proper naming
        main_output_folder = get_output_folder(report_date_str)
        os.makedirs(main_output_folder, exist_ok=True)
        
        # Copy PowerPoint template
        template_success = setup_powerpoint_template(main_output_folder, report_date_str)
        
        # Process each crime type
        results = {}
        total_crimes = len(CRIME_TYPES)
        
        print(f"\nðŸ“Š PROCESSING {total_crimes} CRIME TYPES")
        print("=" * 50)
        
        for i, crime_type in enumerate(CRIME_TYPES, 1):
            print(f"\n[{i}/{total_crimes}] Processing {crime_type}...")
            
            # Create crime-specific folder
            crime_folder = get_crime_type_folder(crime_type, report_date_str)
            os.makedirs(crime_folder, exist_ok=True)
            
            crime_results = {
                'folder_created': True,
                'map': False,
                'chart': False,
                'table': False
            }
            
            if generate_all:
                # Generate map
                print(f"  ðŸ—ºï¸ Generating map...")
                try:
                    map_success = export_maps(crime_type, crime_folder, [
                        'main.py', 'true', 'true', 'false', '30', 'false', report_date_str
                    ])
                    crime_results['map'] = map_success
                    print(f"    {'âœ…' if map_success else 'âŒ'} Map: {'Success' if map_success else 'Failed'}")
                except Exception as e:
                    print(f"    âŒ Map failed: {e}")
                
                # Generate chart (crime-specific time-of-day)
                print(f"  ðŸ“ˆ Generating chart...")
                try:
                    chart_success = export_chart(crime_type)
                    crime_results['chart'] = chart_success
                    print(f"    {'âœ…' if chart_success else 'âŒ'} Chart: {'Success' if chart_success else 'Failed'}")
                except Exception as e:
                    print(f"    âŒ Chart failed: {e}")
                
                # Generate incident table
                print(f"  ðŸ“‹ Generating incident table...")
                try:
                    table_success = export_incident_table_data_with_autofit(crime_type, report_date)
                    if not table_success:
                        # Create placeholder if no incidents
                        filename_prefix = get_standardized_filename(crime_type)
                        placeholder_path = os.path.join(crime_folder, f"{filename_prefix}_IncidentTable_Placeholder.png")
                        table_success = create_incident_table_placeholder(crime_type, placeholder_path)
                    
                    crime_results['table'] = table_success
                    print(f"    {'âœ…' if table_success else 'âŒ'} Table: {'Success' if table_success else 'Failed'}")
                except Exception as e:
                    print(f"    âŒ Table failed: {e}")
            
            results[crime_type] = crime_results
            
            # Show crime summary
            success_count = sum(1 for result in crime_results.values() if result)
            print(f"  ðŸ“Š {crime_type}: {success_count}/4 components successful")
        
        # Generate statistical reports
        if generate_all:
            print(f"\nðŸ“Š GENERATING STATISTICAL REPORTS")
            print("-" * 40)
            try:
                stats_success = generate_statistical_exports_fixed(report_date)
                print(f"{'âœ…' if stats_success else 'âŒ'} Statistical reports: {'Success' if stats_success else 'Failed'}")
            except Exception as e:
                print(f"âŒ Statistical reports failed: {e}")
                stats_success = False
        else:
            stats_success = True
        
        # Assemble PowerPoint
        if generate_all and template_success:
            print(f"\nðŸŽ¯ ASSEMBLING POWERPOINT PRESENTATION")
            print("-" * 40)
            try:
                ppt_success = assemble_powerpoint_presentation(main_output_folder, results, report_date_str)
                print(f"{'âœ…' if ppt_success else 'âŒ'} PowerPoint assembly: {'Success' if ppt_success else 'Failed'}")
            except Exception as e:
                print(f"âŒ PowerPoint assembly failed: {e}")
                ppt_success = False
        else:
            ppt_success = template_success
        
        # Calculate overall success
        crime_success_count = sum(1 for crime_results in results.values() 
                                if sum(1 for result in crime_results.values() if result) >= 2)
        overall_success = (crime_success_count >= len(CRIME_TYPES) * 0.6 and 
                          stats_success and ppt_success)
        
        # Summary
        total_time = time.time() - start_time
        print(f"\nðŸŽ‰ SCRPA SYSTEM COMPLETE")
        print("=" * 60)
        print(f"Processing time: {total_time:.1f} seconds")
        print(f"Overall success: {'âœ… SUCCESS' if overall_success else 'âŒ PARTIAL SUCCESS'}")
        print(f"Crime types processed: {crime_success_count}/{len(CRIME_TYPES)}")
        print(f"Statistical reports: {'âœ…' if stats_success else 'âŒ'}")
        print(f"PowerPoint assembly: {'âœ…' if ppt_success else 'âŒ'}")
        print(f"Output folder: {main_output_folder}")
        
        # Detailed results
        print(f"\nðŸ“‹ DETAILED RESULTS:")
        for crime_type, crime_results in results.items():
            success_components = [comp for comp, success in crime_results.items() if success]
            print(f"  {crime_type}: {len(success_components)}/4 - {', '.join(success_components)}")
        
        return overall_success
        
    except Exception as e:
        print(f"âŒ SCRPA system failed: {e}")
        logging.error(f"SCRPA system failed: {e}", exc_info=True)
        return False

def setup_powerpoint_template(output_folder, report_date_str):
    """Setup PowerPoint template in output folder"""
    try:
        # Get template path
        template_path = POWERPOINT_TEMPLATES.get("7day") or POWERPOINT_TEMPLATES.get("main")
        
        if not template_path or not os.path.exists(template_path):
            print(f"âš ï¸ PowerPoint template not found: {template_path}")
            return False
        
        # Create destination file
        folder_name = get_correct_folder_name(report_date_str)
        dest_ppt = os.path.join(output_folder, f"{folder_name}.pptx")
        
        # Copy template
        shutil.copy2(template_path, dest_ppt)
        print(f"âœ… PowerPoint template copied: {os.path.basename(dest_ppt)}")
        
        return True
        
    except Exception as e:
        print(f"âŒ PowerPoint template setup failed: {e}")
        return False

def assemble_powerpoint_presentation(output_folder, results, report_date_str):
    """Assemble PowerPoint presentation with all components"""
    try:
        from pptx import Presentation
        from pptx.util import Inches
        
        # Find PowerPoint file
        ppt_files = glob.glob(os.path.join(output_folder, "*.pptx"))
        if not ppt_files:
            print(f"âŒ No PowerPoint file found in: {output_folder}")
            return False
        
        ppt_file = ppt_files[0]
        prs = Presentation(ppt_file)
        
        print(f"ðŸ“ Assembling {len(prs.slides)} slides...")
        
        # PowerPoint coordinates (from your working system)
        coords = {
            'chart': {'left': 0.5, 'top': 2.8, 'width': 5.84, 'height': 4.00},
            'map': {'left': 6.8, 'top': 2.8, 'width': 5.60, 'height': 4.03},
            'table': {'left': 6.8, 'top': 0.8, 'width': 8.33, 'height': 1.98}
        }
        
        slides_processed = 0
        for i, crime_type in enumerate(CRIME_TYPES):
            if i >= len(prs.slides):
                print(f"âš ï¸ No slide for {crime_type}")
                continue
            
            slide = prs.slides[i]
            crime_folder = get_crime_type_folder(crime_type, report_date_str)
            filename_prefix = get_standardized_filename(crime_type)
            
            # Add chart
            chart_path = os.path.join(crime_folder, f"{filename_prefix}_Chart.png")
            if os.path.exists(chart_path):
                try:
                    slide.shapes.add_picture(
                        chart_path,
                        Inches(coords['chart']['left']),
                        Inches(coords['chart']['top']),
                        Inches(coords['chart']['width']),
                        Inches(coords['chart']['height'])
                    )
                    print(f"  âœ… Added chart for {crime_type}")
                except Exception as e:
                    print(f"  âŒ Chart addition failed for {crime_type}: {e}")
            
            # Add map
            map_path = os.path.join(crime_folder, f"{filename_prefix}_Map.png")
            if os.path.exists(map_path):
                try:
                    slide.shapes.add_picture(
                        map_path,
                        Inches(coords['map']['left']),
                        Inches(coords['map']['top']),
                        Inches(coords['map']['width']),
                        Inches(coords['map']['height'])
                    )
                    print(f"  âœ… Added map for {crime_type}")
                except Exception as e:
                    print(f"  âŒ Map addition failed for {crime_type}: {e}")
            
            # Add incident table
            table_paths = [
                os.path.join(crime_folder, f"{filename_prefix}_IncidentTable_AutoFit.png"),
                os.path.join(crime_folder, f"{filename_prefix}_IncidentTable.png"),
                os.path.join(crime_folder, f"{filename_prefix}_IncidentTable_Placeholder.png")
            ]
            
            for table_path in table_paths:
                if os.path.exists(table_path):
                    try:
                        slide.shapes.add_picture(
                            table_path,
                            Inches(coords['table']['left']),
                            Inches(coords['table']['top']),
                            Inches(coords['table']['width']),
                            Inches(coords['table']['height'])
                        )
                        print(f"  âœ… Added table for {crime_type}")
                        break
                    except Exception as e:
                        print(f"  âŒ Table addition failed for {crime_type}: {e}")
            
            slides_processed += 1
        
        # Save presentation
        prs.save(ppt_file)
        print(f"âœ… PowerPoint saved: {os.path.basename(ppt_file)}")
        
        return True
        
    except Exception as e:
        print(f"âŒ PowerPoint assembly failed: {e}")
        return False

def check_folder_structure(report_date_str):
    """Check and display current folder structure"""
    print(f"\nðŸ“ CHECKING FOLDER STRUCTURE")
    print("=" * 50)
    
    try:
        main_output = get_output_folder(report_date_str)
        print(f"Main output: {main_output}")
        
        if os.path.exists(main_output):
            print(f"âœ… Main folder exists")
            
            for crime_type in CRIME_TYPES:
                crime_folder = get_crime_type_folder(crime_type, report_date_str)
                folder_name = os.path.basename(crime_folder)
                
                if os.path.exists(crime_folder):
                    files = os.listdir(crime_folder)
                    print(f"âœ… {folder_name}: {len(files)} files")
                    
                    # Check for specific files
                    filename_prefix = get_standardized_filename(crime_type)
                    expected_files = [
                        f"{filename_prefix}_Chart.png",
                        f"{filename_prefix}_Map.png",
                        f"{filename_prefix}_IncidentTable.png"
                    ]
                    
                    for expected_file in expected_files:
                        if expected_file in files:
                            print(f"    âœ… {expected_file}")
                        else:
                            print(f"    âŒ Missing: {expected_file}")
                else:
                    print(f"âŒ {folder_name}: Folder not found")
        else:
            print(f"âŒ Main folder not found")
            
    except Exception as e:
        print(f"âŒ Error checking folders: {e}")

# Command-line interface
def main():
    """Main entry point"""
    if len(sys.argv) > 1:
        command = sys.argv[1].lower()
        
        if command == "check":
            # Check folder structure
            date_str = sys.argv[2] if len(sys.argv) > 2 else date.today().strftime("%Y_%m_%d")
            check_folder_structure(date_str)
            
        elif command == "run":
            # Run complete system
            date_str = sys.argv[2] if len(sys.argv) > 2 else date.today().strftime("%Y_%m_%d")
            success = run_complete_scrpa_system(date_str, generate_all=True)
            sys.exit(0 if success else 1)
            
        elif command == "charts":
            # Generate only charts
            date_str = sys.argv[2] if len(sys.argv) > 2 else date.today().strftime("%Y_%m_%d")
            print("ðŸ“ˆ Generating charts only...")
            
            for crime_type in CRIME_TYPES:
                try:
                    success = export_chart(crime_type)
                    print(f"{'âœ…' if success else 'âŒ'} {crime_type} chart")
                except Exception as e:
                    print(f"âŒ {crime_type} chart failed: {e}")
        
        else:
            print(f"Unknown command: {command}")
            print("Usage: python scrpa_complete_integration.py [run|check|charts] [YYYY_MM_DD]")
    else:
        # Default: run complete system
        success = run_complete_scrpa_system()
        sys.exit(0 if success else 1)

if __name__ == "__main__":
    main()
````

## ðŸ”§ **Complete SCRPA Integration Solution**

I've created a comprehensive integration script that combines all your working components:

### **ðŸ“Š What This Fixes:**

1. **Crime-Specific Time Charts** - Uses your working `export_chart()` function
2. **Proper Folder Structure** - Creates crime-specific folders with all components
3. **ArcGIS Maps** - Uses your working `export_maps()` function  
4. **Incident Tables** - Includes placeholders for zero-incident crime types
5. **Statistical Reports** - Integrates the fixed statistical exports
6. **PowerPoint Assembly** - Automated slide creation

### **ðŸš€ How to Use:**

Save the code above as: `scrpa_complete_integration.py`

#### **Run Complete System:**
```cmd
cd C:\Users\carucci_r\SCRPA_LAPTOP\scripts
"C:\Program Files\ArcGIS\Pro\bin\Python\envs\arcgispro-py3\python.exe" scrpa_complete_integration.py run 2025_07_01
```

#### **Check Current Folder Structure:**
```cmd
"C:\Program Files\ArcGIS\Pro\bin\Python\envs\arcgispro-py3\python.exe" scrpa_complete_integration.py check 2025_07_01
```

#### **Generate Only Charts:**
```cmd
"C:\Program Files\ArcGIS\Pro\bin\Python\envs\arcgispro-py3\python.exe" scrpa_complete_integration.py charts 2025_07_01
```

### **ðŸ“ Expected Output Structure:**

```
C:\Users\carucci_r\SCRPA_LAPTOP\projects\output\C07W27_2025_07_01_7Day\
â”œâ”€â”€ C07W27_2025_07_01_7Day.pptx
â”œâ”€â”€ MV_Theft/
â”‚   â”œâ”€â”€ MV_Theft_Chart.png           # âœ… Crime-specific time chart
â”‚   â”œâ”€â”€ MV_Theft_Map.png             # âœ… ArcGIS map with symbology
â”‚   â”œâ”€â”€ MV_Theft_IncidentTable.png   # âœ… Incident table or placeholder
â”‚   â””â”€â”€ MV_Theft_Manual_Entry.csv    # âœ… CSV for manual completion
â”œâ”€â”€ Burglary_Auto/
â”œâ”€â”€ Burglary_Comm_And_Res/
â”œâ”€â”€ Robbery/
â”œâ”€â”€ Sexual_Offenses/
â””â”€â”€ Statistical_Reports/             # âœ… Your working statistical exports
```

### **ðŸŽ¯ Key Features:**

- âœ… **Uses your existing working functions** (export_chart, export_maps, etc.) - âœ… **Creates proper crime-specific folders** with standardized naming
- âœ… **Integrates statistical reports** seamlessly  
- âœ… **Automated PowerPoint assembly** with all components
- âœ… **Error handling and progress tracking**
- âœ… **Flexible command-line interface**

This should resolve both the chart issue (crime-specific time charts) and the missing folder structure. The system will create the complete setup you need with all components properly organized! Try running it and let me know what results you get! ðŸš€



## Prompt:
7/1/2025, 5:14:27 AM

> File: paste.txt





## Response:
7/1/2025, 5:15:11 AM

I see the issue! There's a datetime import conflict. The problem is we're importing the `datetime` module but trying to use `datetime.datetime.strptime()`.