Data Specifications
Geographic Coverage:
- Bergen County, NJ (primary jurisdiction)
- Passaic, Essex, Hudson, Union Counties (NJ)
- Bronx, Manhattan, Brooklyn, Rockland, Dutchess (NY)
- Berks, Franklin Counties (PA)

Problem Addresses Previously:
- 07601 → Bergen, NJ / Hackensack
- 10458 → Bronx, NY / Bronx  
- 07505 → Passaic, NJ / Paterson
6. Next Week Migration Plan
Phase 2: Python data processing
- Python handles Excel file processing + geographic mapping
- Power BI receives clean CSV/Parquet files
- Eliminates complex M Code dependencies
- Uses comprehensive ZIP database for 99%+ accuracy
Copy/paste this context block into your new chat and we can pick up exactly where we left off! case_number dob age address race sex arrest_date charge officer_of_record County_State file_year_month place_of_arrest report_calc_summary juvenile_flag ucr_code reviewed 23-105132 10/17/1999 25 27 Iowa Rd, Wayne, NJ 07470 1A White Hisp. F 2/10/2025 Shoplifting 2C:20-11 Det. Panagiotis Seretis






= Table.AddColumn(MatchCity, "County_State", each if [matched_municipality] <> null then // Bergen County, NJ if [matched_municipality] = "hackensack" then "Bergen, NJ" else if [matched_municipality] = "hacknesack" then "Bergen, NJ" else if [matched_municip









Arrest_Master /

25_05_Arrest_BackTrace.xlsx
xlsx


2025_05_Arrests.xlsx
xlsx

Good thinking! The BackTrace data could definitely help with the municipality/address issue, but let's be strategic about it. For your new chat, add this enhanced summary:
Power BI Arrest Data Project - Continuation
I'm working on a Power BI query to load arrest data with municipality/county lookup. Here's where we left off:
What's Working:
* M code loads arrest files from folder (excludes Archive subfolder)
* Municipality matching works at 95% rate
* Address matching finds: hackensack, manhattan, newark, bronx, etc. * Lookup table has cleaned municipality names (removed suffixes like "City", "Borough")
Current Issue:
* Final step state_county_residence keeps throwing errors when trying to combine County + State
* Can't get the lookup reference syntax right between Enriched table (has matched_municipality) and LowerLookup table (has County, State)
* Need: "Bergen, NJ" for Hackensack, "New York, NY" for Manhattan, etc. Data Structure:
* Enriched table: has matched_municipality column with values like "hackensack", "manhattan"
* LowerLookup table: has municipality_lower, County, State columns
* Goal: Match on municipality_lower to get County + State
Applied Steps: folderPath → ... → Enriched → state_county_residence (broken)
Additional Data Available:
* Primary: Lawsoft CAD/RMS data (C:\Users\carucci_r\OneDrive - City of Hackensack\_LawSoft\_EXPORT\Arrest) - complete arrest count
* Secondary: BackTrace data (C:\Users\carucci_r\OneDrive - City of Hackensack\_MONTHLY_DATA\_EXPORTS\GTBM\BACKTRACE\ARREST) - more robust address data but only fingerprinted arrests
Question: Should we use BackTrace data to improve address/municipality matching, then join back to Lawsoft for complete counts? Or focus on fixing the current lookup syntax issue first? Need help with the final lookup step to create proper county/state combinations. This gives the AI options to either fix the current issue OR suggest using BackTrace as a supplementary data source for better geocoding! Edit
Strategic Assessment:

Fix the current lookup syntax first - you're 95% there. Then enhance with BackTrace data as Phase 2. Immediate Fix for state_county_residence Step:

m
state_county_residence = Table.AddColumn(
    Enriched, 
    "County_State", 
    each 
        let
            lookupResult = Table.SelectRows(
                LowerLookup, 
                (row) => row[municipality_lower] = [matched_municipality]
            )
        in
            if Table.RowCount(lookupResult) > 0 
            then 
                let
                    firstRow = Table.FirstN(lookupResult, 1){0}
                in
                    firstRow[County] & ", " & firstRow[State]
            else 
                "Unknown"
)
Key Fixes:

Uses Table.SelectRows instead of direct reference
Handles no-match cases with "Unknown"
Extracts first matching row properly
Concatenates County + State with comma-space
Phase 2 Enhancement Strategy:

Keep current Lawsoft as primary (complete arrest counts)
Add BackTrace as address enrichment source
Create hybrid approach:
Match arrests by booking number/date
Use BackTrace addresses where available (better quality)
Fall back to Lawsoft addresses for non-fingerprinted arrests
Pitfalls to Watch:

BackTrace may have different date formats
Booking number formats might not align
Could create duplicate counts if not careful with joins
Try the syntax fix first - should resolve your immediate blocker. Enriched step:
= Table.AddColumn(#"Enriched", "state_county_residence", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(#"LowerLookup", each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
has error:
Expression.Error: The name 'Enriched' wasn't recognized. Make sure it's spelled correctly. Edit
The Issue: You're referencing #"Enriched" inside the column formula, but it should reference the previous step name. Quick Fix: Replace #"Enriched" with the actual previous step name in your Applied Steps. Check Your Applied Steps Panel: Look at the step just before state_county_residence - it might be named something like:

#"Added Custom"
#"Renamed Columns"
#"Filtered Rows"
Corrected Syntax:

m
= Table.AddColumn([PREVIOUS_STEP_NAME], "state_county_residence", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Also Note:

Changed #"LowerLookup" to just LowerLookup (no quotes needed for simple names)
The [matched_municipality] reference inside the Table.SelectRows refers to the current row being processed
To Find Previous Step Name:

Click on the step just above state_county_residence
Look at the formula bar - the step name appears after the = sign
What's the name of the step right before your current state_county_residence step? image.png
image.png
image.png
attachments:
1. Enriched
2. state_county_residence
3. Final

Edit
Found the Issues:

Previous step is "Enriched" (confirmed in Applied Steps panel)
Your code looks correct - the issue is Power BI can't convert the step result to a table
Quick Fix - Delete and Recreate the Step:

Delete the state_county_residence step (right-click → Delete)
Click on "Enriched" step to select it
Add this exact code:
m
= Table.AddColumn(Enriched, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Key Changes:

Removed quotes around Enriched
Removed quotes around LowerLookup
Changed column name to County_State (simpler)
Alternative - Manual UI Method:

Select "Enriched" step
Add Column → Custom Column
Name: County_State
Formula:
m
if [matched_municipality] <> null then 
    let 
        found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
    in 
        if Table.RowCount(found) > 0 then 
            found{0}[County] & ", " & found{0}[State]
        else "Unmatched" 
else "N/A"
The error suggests Power BI is having trouble with the step definition itself. Fresh start should resolve it. image.png
I added the code to enriched step and got

Edit
The Problem: You're trying to edit the "Enriched" step directly, but it doesn't recognize "Enriched" as a table reference within its own definition. Solution - Create New Step Instead:

Click on "Enriched" step in Applied Steps (to select it as the current step)
Go to Add Column → Custom Column in the ribbon
Name: County_State
Formula:
m
if [matched_municipality] <> null then 
    let 
        found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
    in 
        if Table.RowCount(found) > 0 then 
            found{0}[County] & ", " & found{0}[State]
        else "Unmatched" 
else "N/A"
Why This Works:

Power BI automatically creates the Table.AddColumn() wrapper
References the current step (Enriched) automatically
No need to reference table names in the formula
Alternative - Manual Step Creation: If you want to manually add a step:

Right-click after "Enriched" step → Insert Step After
Use this complete formula:
m
= Table.AddColumn(#"Enriched", "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A")
The UI method is cleaner and less error-prone. can't add custom column with an error

Edit
Try This Step-by-Step Approach:

Method 1: Use Table.Join Instead

Click on "Enriched" step
Home tab → Merge Queries
Select columns:
Left table: matched_municipality
Right table: Select LowerLookup → municipality_lower
Join Kind: Left Outer
Click OK
Expand the new column to get County and State
Add Custom Column with simple formula: [County] & ", " & [State]
Method 2: Simpler Custom Column Try a basic test first:

Add Column → Custom Column
Name: Test
Formula: "test"
If this works, replace with the lookup formula
Method 3: Check Your LowerLookup Reference The error might be that LowerLookup table isn't accessible. Quick Debug:

What happens if you click on different steps? Can you see the "LowerLookup" table in the Queries panel on the left? Is "LowerLookup" exactly how it's named (case-sensitive)? Method 4: Manual Advanced Editor

Home → Advanced Editor
Add this line before the final in statement:
m
state_county_residence = Table.AddColumn(Enriched, "County_State", each if [matched_municipality] <> null then let found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality]) in if Table.RowCount(found) > 0 then found{0}[County] & ", " & found{0}[State] else "Unmatched" else "N/A"),
Which method can you try first? The merge approach is most reliable. i don't see merge

Edit
Finding Merge in Power BI:

Location depends on your version:

Power BI Desktop:

Home tab → Look for "Merge Queries" button
OR Data tab → "Merge Queries"
OR right-click on query name → "Merge Queries"
Power Query Editor (most common):

Home tab → "Merge Queries" (should be there)
OR Home tab → "Combine" group → "Merge Queries"
If you still don't see it:

Alternative - Manual Join Method:

Advanced Editor approach - add this before the final in:
m
JoinedData = Table.NestedJoin(Enriched, {"matched_municipality"}, LowerLookup, {"municipality_lower"}, "LookupTable", JoinKind.LeftOuter),
ExpandedJoin = Table.ExpandTableColumn(JoinedData, "LookupTable", {"County", "State"}, {"County", "State"}),
FinalResult = Table.AddColumn(ExpandedJoin, "County_State", each if [County] <> null then [County] & ", " & [State] else "Unmatched"),
Quick Check:

Are you in Power Query Editor (not the main Power BI interface)? What tabs do you see at the top? Should see: Home, Transform, Add Column, View
Screenshot Request: Can you show me what tabs you see in your ribbon? That'll help me guide you to the right location. image.png
I don't see data tab in power bi power query, the right click on query name didn't work either

Edit
Perfect! Use "Insert Step After":

Right-click on "Enriched" step (as shown in your screenshot)
Click "Insert Step After"
Paste this complete formula:
m
= Table.NestedJoin(Enriched, {"matched_municipality"}, LowerLookup, {"municipality_lower"}, "LookupData", JoinKind.LeftOuter)
Press Enter - this creates a joined table
Right-click the new step → Insert Step After again
Paste this formula:
m
= Table.ExpandTableColumn(#"Previous Step Name", "LookupData", {"County", "State"}, {"County", "State"})
Right-click again → Insert Step After
Final formula:
m
= Table.AddColumn(#"Previous Step Name", "County_State", each 
    if [County] <> null and [State] <> null 
    then [County] & ", " & [State] 
    else "Unmatched")
Note: Replace #"Previous Step Name" with whatever Power BI auto-names the steps (like #"Added Custom", etc.) This approach:

Uses table joins instead of custom lookups
More reliable than complex custom columns
Easier to debug step-by-step
Try the first step - does the join work? image.png
image.png
image.png
how would they work if Enriched has error: Expression.Error: The name 'Enriched' wasn't recognized. Make sure it's spelled correctly. Enriched code:
= Table.AddColumn(Enriched, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)

Edit
The Root Problem: You're trying to reference "Enriched" from within the "Enriched" step itself - that's circular and won't work. Solution: Fix the Reference

The "Enriched" step should reference the previous step, not itself. Look at your Applied Steps - what's the step RIGHT BEFORE "Enriched"? Based on your steps, it's probably "MatchCity". Fix the Enriched Step:

Click on "Enriched" step
Replace the formula with:
m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Or Better Yet - Rename the Step:

Right-click "Enriched" → Rename → "County_State_Added"
Use this formula:
m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Key Point: Each step references the step before it, never itself. What's the name of the step right before "Enriched" in your Applied Steps? image.png
Edit
I see the issue now! The step before "Enriched" is "MatchCity" - and your data quality shows 94% errors on County_State column. Fix the Enriched Step:

Click on "Enriched" step
Replace the formula with:
m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
But the 94% Error Rate Suggests a Deeper Issue:

Diagnostic Questions:

Click on "MatchCity" step - does it show the matched_municipality column properly? Click on "LowerLookup" step - does it have the right column names (municipality_lower, County, State)? Quick Test Method: Try a simpler lookup first:

Change the Enriched formula to this simple test:
m
= Table.AddColumn(MatchCity, "Test_Column", each "Working", type text)
If that works, then try:
m
= Table.AddColumn(MatchCity, "Test_Lookup", each 
    if [matched_municipality] <> null 
    then [matched_municipality] & "_test"
    else "null_value", type text)
Most Likely Issue:

Column names in LowerLookup don't match exactly
matched_municipality column has different values than expected
Let's start with the simple test - does that work? image.png
on MatchCity step 0 errors, 5 % empty

Edit
Great! The data looks good at MatchCity step. I can see the issue - your matched_municipality values are clean:

manhattan, hackensack, newark, bronx, etc. Now let's check your LowerLookup table:

Click on "LowerLookup" step
Check if the column names are exactly:
municipality_lower
County
State
And verify a few sample values match:

Does LowerLookup have manhattan → New York, NY? Does LowerLookup have hackensack → Bergen, NJ? Current Fix for County_State_Added Step:

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Since you have 95% valid matched_municipality values, the lookup should work well. Can you show me what the LowerLookup table looks like? Specifically:

Column names
A few sample rows (manhattan, hackensack, newark)
That'll help us nail down why the lookup is failing. image.png
Municipality, County, State, municipality_lower

Edit
Perfect! Now I see the issue. Your LowerLookup table looks good, but I notice most of these are Atlantic County, NJ municipalities. Let me check if the key municipalities from your arrest data are in this lookup table. From your MatchCity data, you have:

manhattan
hackensack
newark
bronx
But your LowerLookup shows Atlantic County municipalities like:

absecon, atlantic, brigantine, etc. Quick Check:

Scroll down in LowerLookup - do you see entries for:
manhattan
hackensack
newark
bronx
If they're missing, that explains the 94% error rate. Two Solutions:

Option 1: Add Missing Municipalities Add these key entries to your lookup table:

manhattan → New York, NY
hackensack → Bergen, NJ
newark → Essex, NJ
bronx → Bronx, NY
Option 2: Test Current Formula Let's try the formula with what you have:

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Can you scroll through LowerLookup to see if the major cities are there? I found all except for manhattan this may be due to limited list only showing 1000 records

Edit
Perfect! That explains why it's mostly working. Manhattan is likely there but not shown due to the 1000 record limit. Let's implement the fix and test:

Click on "County_State_Added" step
Use this corrected formula:
m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
This should work much better now! Expected Results:

hackensack → Bergen, NJ
newark → Essex, NJ
bronx → Bronx, NY
manhattan → New York, NY (if it's in the full dataset)
Other municipalities → matched values
Unrecognized → "Unmatched"
After applying, check the data quality:

Error rate should drop significantly from 94%
You should see proper county/state combinations
If Manhattan is still missing: Quick manual fix - add this line to handle the special case:

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] = "manhattan" then "New York, NY"
    else if [matched_municipality] <> null then 
        let 
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Try the first version - what's your error rate now? image.png
County_State_Added 94% error

Edit
The lookup is still failing. Let's debug this step by step. Issue: The reference to LowerLookup table might not be working correctly. Try this diagnostic approach:

Step 1: Simple Test Replace the County_State_Added formula with this simple test:

m
= Table.AddColumn(MatchCity, "Test_Lookup", each 
    let
        found = Table.SelectRows(LowerLookup, each [municipality_lower] = "hackensack")
    in
        if Table.RowCount(found) > 0 then "Found" else "Not Found", type text)
If that shows "Not Found" everywhere, the issue is the LowerLookup reference. Step 2: Check Table Reference The problem might be that LowerLookup isn't accessible from this query. Quick Fix Options:

Option A: Use Full Table Reference

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        let 
            lookupTable = #"LowerLookup",
            found = Table.SelectRows(lookupTable, each [municipality_lower] = [matched_municipality])
        in 
            if Table.RowCount(found) > 0 then 
                found{0}[County] & ", " & found{0}[State]
            else "Unmatched" 
    else "N/A", type text)
Option B: Manual Hard-Code Key Values

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] = "hackensack" then "Bergen, NJ"
    else if [matched_municipality] = "newark" then "Essex, NJ"
    else if [matched_municipality] = "manhattan" then "New York, NY"
    else if [matched_municipality] = "bronx" then "Bronx, NY"
    else "Unmatched", type text)
Try Option A first - does that resolve the lookup issue? result = found

Edit
Great! The lookup is working - the issue is something else. Now let's test with actual matching:

Replace the County_State_Added formula with:

m
= Table.AddColumn(MatchCity, "Test_Match", each 
    let
        found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
    in
        if Table.RowCount(found) > 0 then 
            "Match: " & found{0}[County] & ", " & found{0}[State]
        else 
            "No match for: " & Text.From([matched_municipality]), type text)
This will show us:

For successful matches: "Match: Bergen, NJ"
For failures: "No match for: manhattan" (or whatever value isn't matching)
This diagnostic will tell us:

If the match logic works
Which specific municipalities are failing
Whether it's a data type issue or missing values
Run this test and let me know what you see in the Test_Match column. That will tell us exactly what's happening with each municipality lookup. that returned error:
= Table.AddColumn(MatchCity, "Test_Match", each 
    let
        found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
    in
        if Table.RowCount(found) > 0 then 
            "Match: " & found{0}[County] & ", " & found{0}[State]
        else 
            "No match for: " & Text.From([matched_municipality]), type text)

Edit
The error is likely due to null values in matched_municipality. Try this safer version:

m
= Table.AddColumn(MatchCity, "Test_Match", each 
    if [matched_municipality] <> null then
        let
            found = Table.SelectRows(LowerLookup, each [municipality_lower] = [matched_municipality])
        in
            if Table.RowCount(found) > 0 then 
                "Match: " & found{0}[County] & ", " & found{0}[State]
            else 
                "No match for: " & [matched_municipality]
    else "Null value", type text)
Or even simpler test:

m
= Table.AddColumn(MatchCity, "Simple_Test", each 
    if [matched_municipality] <> null then 
        "Value: " & [matched_municipality]
    else 
        "Null", type text)
The issue might be:

Null values in matched_municipality (5% empty as you showed)
Data type mismatches
The Text.From() function causing issues
Try the simpler version first - does that work without errors? image.png
image.png
code 1 100% errors
code 2 no errors

Edit
Excellent! The Simple_Test works perfectly - the matched_municipality values are good. The issue with the lookup is likely the table reference scope. Let's try a different approach:

Replace County_State_Added with this:

m
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        if [matched_municipality] = "hackensack" then "Bergen, NJ"
        else if [matched_municipality] = "newark" then "Essex, NJ"
        else if [matched_municipality] = "manhattan" then "New York, NY"
        else if [matched_municipality] = "bronx" then "Bronx, NY"
        else if [matched_municipality] = "ridgefield park" then "Bergen, NJ"
        else if [matched_municipality] = "staten island" then "Richmond, NY"
        else if [matched_municipality] = "east orange" then "Essex, NJ"
        else if [matched_municipality] = "teaneck" then "Bergen, NJ"
        else if [matched_municipality] = "phillipsburg" then "Warren, NJ"
        else if [matched_municipality] = "moonachie" then "Bergen, NJ"
        else if [matched_municipality] = "paterson" then "Passaic, NJ"
        else if [matched_municipality] = "east rutherford" then "Bergen, NJ"
        else if [matched_municipality] = "camden" then "Camden, NJ"
        else if [matched_municipality] = "fort lee" then "Bergen, NJ"
        else if [matched_municipality] = "york" then "York, PA"
        else "Unmatched"
    else "N/A", type text)
This hardcodes the most common municipalities from your data. Why this approach:

Avoids the table reference issue
Handles your top municipalities immediately
Can expand the list as needed
More reliable than complex lookups in Power BI
Try this version - it should work immediately for your main cities! image.png
Edit
Perfect! It's working! Only 6% errors now - huge improvement from 94%! I can see the county/state mappings are working correctly:

Manhattan → New York, NY ✓
Hackensack → Bergen, NJ ✓
Newark → Essex, NJ ✓
Bronx → Bronx, NY ✓
And many others! Final Steps:

Delete the test columns (Simple_Test, etc.) Remove any unused columns like address_lower, matched_municipality if not needed for final output
Right-click "Final" → Rename → something like "Final_Clean"
Your Power BI query is now ready! Results Summary:

✅ 95% municipality matching rate
✅ 94% county/state lookup success
✅ Clean data ready for visualization
Next Phase Enhancement (if desired):

Add the remaining 6% by expanding the hardcoded list
Or implement the BackTrace data integration we discussed earlier for even better address parsing
The core functionality is working perfectly now! You can load this into your Power BI model and start building your arrest analytics dashboard. Want to clean up those extra columns before finalizing? image.png
image.png

Custom2.xlsx
xlsx


Custom1.xlsx
xlsx

County_State_Added has zero error and and nulls
Custom1 no null or erros
Custom2
the othe Custom steps have several unmatached

Edit
Perfect! You're almost done. The issue is duplicate column names. The Error Says: "The field 'County_State' already exists in the record"

This means you already have a County_State column from the County_State_Added step, and you're trying to add another one. Two Solutions:

Option 1: Use Different Column Name

m
= Table.AddColumn(Custom2, "County_State_Final", each 
    if [County] <> null and [State] <> null 
    then [County] & ", " & [State] 
    else "Unmatched")
Option 2: Remove Previous County_State Column First

m
= Table.RemoveColumns(Custom2, {"County_State"})
Then add your new step with the original name. For Final Cleanup:

m
= Table.RemoveColumns(Custom3, {"address_lower", "matched_municipality", "County", "State"})
Your data flow should be:

County_State_Added → Working (0 errors)
Custom1 → Join with lookup table
Custom2 → Expand columns
Custom3 → Combine County + State (use different name)
Final → Remove helper columns
Try Option 1 with "County_State_Final" as the column name. do I add = Table.AddColumn(Custom2, "County_State_Final", each 
    if [County] <> null and [State] <> null 
    then [County] & ", " & [State] 
    else "Unmatched")
to 
= Table.AddColumn(MatchCity, "County_State", each 
    if [matched_municipality] <> null then 
        if [matched_municipality] = "hackensack" then "Bergen, NJ"
        else if [matched_municipality] = "newark" then "Essex, NJ"
        else if [matched_municipality] = "manhattan" then "New York, NY"
        else if [matched_municipality] = "bronx" then "Bronx, NY"
        else if [matched_municipality] = "ridgefield park" then "Bergen, NJ"
        else if [matched_municipality] = "staten island" then "Richmond, NY"
        else if [matched_municipality] = "east orange" then "Essex, NJ"
        else if [matched_municipality] = "teaneck" then "Bergen, NJ"
        else if [matched_municipality] = "phillipsburg" then "Warren, NJ"
        else if [matched_municipality] = "moonachie" then "Bergen, NJ"
        else if [matched_municipality] = "paterson" then "Passaic, NJ"
        else if [matched_municipality] = "east rutherford" then "Bergen, NJ"
        else if [matched_municipality] = "camden" then "Camden, NJ"
        else if [matched_municipality] = "fort lee" then "Bergen, NJ"
        else if [matched_municipality] = "york" then "York, PA"
        else "Unmatched"
    else "N/A", type text)

Edit
No, don't combine them! They're separate approaches.