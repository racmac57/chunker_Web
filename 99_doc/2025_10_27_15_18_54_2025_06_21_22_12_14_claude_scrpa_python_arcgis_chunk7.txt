Organizes files in crime-specific subfolders. Args:
        crime_type (str): Type of crime to map
        output_folder (str): Base directory (will create crime-specific subfolder)
        args (list): Arguments list where args[6] contains date in format "YYYY_MM_DD"
        
    Returns:
        bool: True if successful, False otherwise
    """
    aprx = None
    
    try:
        # Validate configuration first
        if not validate_config():
            return False
            
        logging.info(f"ğŸ—ºï¸ Starting Excel-based 7-Day map export for: {crime_type}")
        
        # Get date from args
        try:
            date_str = args[6]  # YYYY_MM_DD format
            target_date = datetime.strptime(date_str, "%Y_%m_%d").date()
            arcpy.AddMessage(f"ğŸ“… Using date from args: {target_date}")
        except (IndexError, TypeError, ValueError):
            target_date = date.today()
            date_str = target_date.strftime("%Y_%m_%d")
            
        # Create crime-specific output folder using Excel naming
        crime_output_folder = get_crime_type_folder(crime_type, date_str)
        os.makedirs(crime_output_folder, exist_ok=True)
        arcpy.AddMessage(f"ğŸ“ Crime-specific folder: {crime_output_folder}")
        
        # Get standardized filename prefix
        filename_prefix = get_standardized_filename(crime_type)
        
        # Load ArcGIS Pro project
        aprx = arcpy.mp.ArcGISProject(APR_PATH)
        arcpy.AddMessage(f"âœ… Loaded ArcGIS Pro project: {APR_PATH}")
        
        # Get layout and map objects
        layouts = aprx.listLayouts("Crime Report Legend")
        if not layouts:
            arcpy.AddError("âŒ Layout 'Crime Report Legend' not found")
            available_layouts = [layout.name for layout in aprx.listLayouts()]
            arcpy.AddError(f"Available layouts: {available_layouts}")
            return False
            
        layout = layouts[0]
        arcpy.AddMessage(f"âœ… Found layout: {layout.name}")
        
        # Get map frame
        map_frames = layout.listElements("MAPFRAME_ELEMENT")
        if not map_frames:
            arcpy.AddError("âŒ No map frame elements found in layout")
            return False
            
        map_frame = map_frames[0]
        map_obj = map_frame.map
        arcpy.AddMessage(f"âœ… Found map: {map_obj.name}")

        # Store original layer states for restoration
        original_states = {}
        for lyr in map_obj.listLayers():
            original_states[lyr.name] = {
                'visible': lyr.visible,
                'transparency': lyr.transparency
            }

        # Hide all layers initially
        layer_count = 0
        for lyr in map_obj.listLayers():
            lyr.visible = False
            layer_count += 1
        arcpy.AddMessage(f"ğŸ”„ Hidden {layer_count} layers initially")

        # Show base layers
        base_layers = [
            "City Boundaries",
            "OpenStreetMap Light Gray Canvas Reference", 
            "Light Gray Canvas (for Export)",
            "World Light Gray Canvas Base",
            "OpenStreetMap",
            "Streets"
        ]
        
        base_layers_found = 0
        for lyr in map_obj.listLayers():
            if any(base_name in lyr.name for base_name in base_layers):
                lyr.visible = True
                lyr.transparency = 0
                base_layers_found += 1
                arcpy.AddMessage(f"âœ… Enabled base layer: {lyr.name}")
        
        arcpy.AddMessage(f"âœ… Enabled {base_layers_found} base layers")

        # Get Excel-based 7-day period dates
        start_date, end_date = get_7day_period_dates(target_date)
        
        if not start_date or not end_date:
            arcpy.AddError(f"âŒ Could not determine Excel 7-day period for {target_date}")
            return False
            
        arcpy.AddMessage(f"ğŸ“… Excel 7-Day period: {start_date} to {end_date}")

        # Show available layers for debugging
        all_layers = [lyr.name for lyr in map_obj.listLayers()]
        arcpy.AddMessage(f"ğŸ“‹ Available layers: {all_layers}")

        # Find and configure ONLY the 7-Day layer
        layer_name = f"{crime_type} 7-Day"
        target_layer = None
        
        for lyr in map_obj.listLayers():
            if lyr.name == layer_name:
                target_layer = lyr
                break
        
        if not target_layer:
            arcpy.AddWarning(f"âŒ 7-Day layer not found: {layer_name}")
            # Create enhanced placeholder and return
            export_filename = f"{filename_prefix}_Map.png"
            export_path = os.path.join(crime_output_folder, export_filename)
            success = create_placeholder_image(crime_type, export_path, start_date, end_date)
            return success
        
        # Show only the 7-Day layer
        target_layer.visible = True
        target_layer.transparency = 0  # Full opacity for single layer
        arcpy.AddMessage(f"âœ… Configured 7-Day layer: {target_layer.name}")

        # Apply definition query if supported using Excel dates
        if target_layer.supports("DEFINITIONQUERY"):
            filter_sql = build_sql_filter_7day_excel(crime_type, start_date, end_date)
            
            if filter_sql:
                arcpy.AddMessage(f"ğŸ” Excel-based SQL for 7-Day {layer_name}: {filter_sql}")
                target_layer.definitionQuery = filter_sql
                arcpy.AddMessage(f"âœ… Applied Excel-based query to {target_layer.name}")
                
                # Log feature count
                try:
                    feature_count = int(arcpy.GetCount_management(target_layer).getOutput(0))
                    arcpy.AddMessage(f"ğŸ“Š 7-Day features: {feature_count}")
                    
                    # If no features, create enhanced placeholder instead of map
                    if feature_count == 0:
                        arcpy.AddMessage(f"ğŸ“‹ No 7-day incidents for {crime_type}, creating placeholder")
                        export_filename = f"{filename_prefix}_Map.png"
                        export_path = os.path.join(crime_output_folder, export_filename)
                        success = create_placeholder_image(crime_type, export_path, start_date, end_date)
                        
                        # Restore original layer states
                        restore_layer_states(map_obj, original_states)
                        return success
                        
                except Exception as e:
                    arcpy.AddWarning(f"âš ï¸ Could not get feature count: {e}")
            else:
                arcpy.AddWarning(f"âš ï¸ Could not build SQL filter for {crime_type}")

        # Apply ENHANCED symbology to the 7-Day layer
        apply_symbology_enhanced(target_layer, layer_name)

        # Update legend to show only 7-Day layer
        update_legend_visibility_7day(layout, map_obj, target_layer)

        # Clean up patch elements
        cleanup_patch_elements(layout)

        # Export the map
        success = export_map_to_png(layout, crime_type, crime_output_folder, filename_prefix)
        
        # Restore original layer states
        restore_layer_states(map_obj, original_states)
        
        if success:
            arcpy.AddMessage(f"âœ… Excel-based 7-Day map export completed successfully for {crime_type}")
        
        return success
        
    except Exception as e:
        arcpy.AddError(f"âŒ Critical error in export_maps: {str(e)}")
        logging.error(f"Critical error in export_maps for {crime_type}: {e}", exc_info=True)
        return False
    finally:
        # Clean up ArcGIS Pro project
        if aprx:
            try:
                del aprx
                arcpy.AddMessage("ğŸ§¹ Cleaned up ArcGIS Pro project reference")
            except Exception as e:
                arcpy.AddWarning(f"âš ï¸ Could not clean up project reference: {e}")

def apply_symbology_enhanced(layer, layer_name):
    """
    Apply ENHANCED symbology to crime incident layers - force red circles for visibility. Args:
        layer: ArcPy layer object
        layer_name (str): Name of the layer for logging
    """
    try:
        # Force red circle symbology for crime layers
        if any(crime in layer_name for crime in ["Robbery", "MV Theft", "Burglary", "Sexual Offenses"]):
            arcpy.AddMessage(f"ğŸ¨ Applying enhanced red circle symbology to {layer_name}")
            
            # Get the layer's symbology
            sym = layer.symbology
            
            # Check if it has a renderer (most common case)
            if hasattr(sym, 'renderer') and hasattr(sym.renderer, 'symbol'):
                try:
                    # Set red color and appropriate size
                    sym.renderer.symbol.color = {'RGB': [255, 0, 0, 100]}  # Bright red
                    sym.renderer.symbol.size = 10  # Visible size
                    layer.symbology = sym
                    arcpy.AddMessage(f"âœ… Applied RED CIRCLE symbology to {layer_name}")
                except Exception as e:
                    arcpy.AddWarning(f"âš ï¸ Could not set symbol properties: {e}")
                    # Try alternative approach
                    try:
                        # Alternative method for setting symbology
                        layer.symbology.renderer.symbol.applySymbolFromGallery("Circle 2", 0)
                        arcpy.AddMessage(f"âœ… Applied alternative symbology to {layer_name}")
                    except:
                        arcpy.AddMessage(f"ğŸ’¡ Using default symbology for {layer_name}")
            
            # Try to apply symbology from file if available
            elif SYM_LAYER_PATH and os.path.exists(SYM_LAYER_PATH):
                arcpy.AddMessage(f"ğŸ¨ Applying symbology from file: {SYM_LAYER_PATH}")
                try:
                    sym_layer_file = arcpy.mp.LayerFile(SYM_LAYER_PATH)
                    sym_layers = sym_layer_file.listLayers()
                    
                    if sym_layers:
                        sym_layer = sym_layers[0]
                        arcpy.ApplySymbologyFromLayer_management(layer, sym_layer)
                        arcpy.AddMessage(f"âœ… Applied file symbology to {layer_name}")
                    else:
                        arcpy.AddWarning(f"âš ï¸ No layers found in symbology file")
                except Exception as e:
                    arcpy.AddWarning(f"âŒ Error applying symbology file: {e}")
            
            else:
                arcpy.AddMessage(f"ğŸ’¡ Using default layer symbology for {layer_name}")
        
        else:
            arcpy.AddMessage(f"ğŸ’¡ Skipping symbology for non-crime layer: {layer_name}")
            
    except Exception as e:
        arcpy.AddWarning(f"âŒ Symbology error on {layer_name}: {str(e)}")
        arcpy.AddMessage(f"ğŸ’¡ Continuing with default symbology for {layer_name}")

def build_sql_filter_7day_excel(crime_type, start_date, end_date):
    """
    Build SQL filter for 7-Day period using Excel dates from config. Args:
        crime_type (str): Type of crime
        start_date (date): Start date from Excel
        end_date (date): End date from Excel
    
    Returns:
        str: SQL filter string or None if invalid
    """
    try:
        # Format dates for SQL (using timestamp format)
        start_timestamp = f"{start_date.strftime('%Y-%m-%d')} 00:00:00.000"
        end_timestamp = f"{end_date.strftime('%Y-%m-%d')} 23:59:59.999"
        
        arcpy.AddMessage(f"ğŸ“… Excel-based 7-Day filter period: {start_date} to {end_date}")
        arcpy.AddMessage(f"ğŸ” Start timestamp: {start_timestamp}")
        arcpy.AddMessage(f"ğŸ” End timestamp: {end_timestamp}")
        
    except Exception as e:
        arcpy.AddError(f"âŒ Error formatting Excel dates: {e}")
        return None
    
    # Base conditions for Excel-based 7-day period
    base_conditions = f"disposition LIKE '%See Report%' AND calldate >= timestamp '{start_timestamp}' AND calldate <= timestamp '{end_timestamp}'"
    
    # Get pattern from config
    pattern = get_sql_pattern_for_crime(crime_type)
    arcpy.AddMessage(f"ğŸ’¡ Using pattern for {crime_type}: {pattern}")
    
    # Build crime condition based on pattern type
    if isinstance(pattern, list):
        conditions = []
        for p in pattern:
            conditions.append(f"calltype LIKE '%{p}%'")
        crime_condition = f"({' OR '.join(conditions)})"
    else:
        crime_condition = f"calltype LIKE '%{pattern}%'"
    
    sql_filter = f'{crime_condition} AND {base_conditions}'
    
    arcpy.AddMessage(f"ğŸ” Final Excel-based SQL filter: {sql_filter}")
    return sql_filter

def build_sql_filter_7day(crime_type, start_date):
    """
    Legacy function - now uses Excel integration.
    """ try:
        # Convert start_date string to date object if needed
        if isinstance(start_date, str):
            start_date_obj = datetime.strptime(start_date, "%Y-%m-%d").date()
        else:
            start_date_obj = start_date
            
        # Calculate target date (report due date) 
        target_date = start_date_obj + timedelta(days=7)
        
        # Get Excel-based period
        excel_start, excel_end = get_7day_period_dates(target_date)
        
        if excel_start and excel_end:
            return build_sql_filter_7day_excel(crime_type, excel_start, excel_end)
        else:
            # Fallback to original method
            return build_sql_filter_7day_excel(crime_type, start_date_obj, start_date_obj + timedelta(days=6))
            
    except Exception as e:
        arcpy.AddError(f"âŒ Error in legacy SQL filter: {e}")
        return None

def build_sql_filter(crime_type, start_date):
    """
    Legacy function - redirects to Excel-based 7-day version for compatibility.
    """ return build_sql_filter_7day(crime_type, start_date)

def restore_layer_states(map_obj, original_states):
    """
    Restore all layers to their original visibility and transparency states. Args:
        map_obj: ArcPy map object
        original_states (dict): Dictionary of original layer states
    """
    try:
        for lyr in map_obj.listLayers():
            if lyr.name in original_states:
                lyr.visible = original_states[lyr.name]['visible']
                lyr.transparency = original_states[lyr.name]['transparency']
        arcpy.AddMessage("âœ… Restored original layer states")
    except Exception as e:
        arcpy.AddWarning(f"âš ï¸ Error restoring layer states: {e}")

def apply_symbology(layer, layer_name):
    """
    Legacy function - redirects to enhanced version.
    """ apply_symbology_enhanced(layer, layer_name)

def update_legend_visibility_7day(layout, map_obj, target_layer):
    """
    Update legend to show only the 7-Day layer. Args:
        layout: ArcPy layout object
        map_obj: ArcPy map object  
        target_layer: The 7-Day layer to show in legend
    """
    try:
        # Find legend element (case-insensitive search)
        legend = None
        for elm in layout.listElements("LEGEND_ELEMENT"):
            if elm.name.strip().lower() == "mainlegend":
                legend = elm
                break
                
        if not legend:
            arcpy.AddWarning("âš ï¸ Legend element 'mainlegend' not found")
            return
        
        arcpy.AddMessage(f"âœ… Found legend with {len(legend.items)} items")
        
        # Disable syncLayerVisibility so we can control legend manually
        legend.syncLayerVisibility = False
        arcpy.AddMessage(f"ğŸ”§ Disabled syncLayerVisibility for manual control")
        
        # Hide all legend items first
        for item in legend.items:
            item.visible = False
        
        # Show only the 7-Day layer in legend
        shown_count = 0
        for item in legend.items:
            if item.name == target_layer.name:
                item.visible = True
                shown_count += 1
                arcpy.AddMessage(f"âœ… Showing in legend: {item.name}")
        
        arcpy.AddMessage(f"ğŸ¯ Legend updated: {shown_count} items shown (7-Day only)")
        
    except Exception as e:
        arcpy.AddWarning(f"âŒ Legend update error: {str(e)}")

def update_legend_visibility(layout, map_obj, suffix_layers):
    """
    Legacy function - redirects to 7-day version.
    """ if suffix_layers:
        # Find the 7-Day layer from suffix_layers
        for key, layer in suffix_layers:
            if "7-Day" in key:
                update_legend_visibility_7day(layout, map_obj, layer)
                break

def cleanup_patch_elements(layout):
    """
    Remove patch elements from layout. Args:
        layout: ArcPy layout object
    """
    try:
        elements_to_remove = []
        for elm in layout.listElements("PICTURE_ELEMENT"):
            if "hackensack" in elm.name.lower() or "patch" in elm.name.lower():
                elements_to_remove.append(elm)
                
        if not elements_to_remove:
            arcpy.AddMessage("ğŸ’¡ No patch elements found to remove")
            return
                
        for elm in elements_to_remove:
            try:
                layout.removeElement(elm)
                arcpy.AddMessage(f"ğŸ§¹ Removed patch element: {elm.name}")
            except Exception as e:
                arcpy.AddWarning(f"âŒ Failed to remove patch element {elm.name}: {str(e)}")
                
        arcpy.AddMessage(f"âœ… Patch cleanup completed: {len(elements_to_remove)} elements processed")
                
    except Exception as e:
        arcpy.AddWarning(f"âŒ Patch cleanup failed: {str(e)}")

def export_map_to_png(layout, crime_type, output_folder, filename_prefix):
    """
    Export layout to PNG file with standardized naming. Args:
        layout: ArcPy layout object
        crime_type (str): Type of crime for logging
        output_folder (str): Output directory
        filename_prefix (str): Standardized filename prefix
        
    Returns:
        bool: True if successful, False otherwise
    """
    try:
        # Ensure output folder exists
        if not os.path.exists(output_folder):
            os.makedirs(output_folder)
            arcpy.AddMessage(f"ğŸ“ Created output folder: {output_folder}")
        else:
            arcpy.AddMessage(f"ğŸ“ Using existing output folder: {output_folder}")
            
        # Clean up old map files with standardized pattern
        cleanup_pattern = os.path.join(output_folder, f"{filename_prefix}_Map*.png")
        old_files = glob.glob(cleanup_pattern)
        
        removed_count = 0
        for file_path in old_files:
            try:
                os.remove(file_path)
                arcpy.AddMessage(f"ğŸ§¹ Deleted old export: {os.path.basename(file_path)}")
                removed_count += 1
            except Exception as e:
                arcpy.AddWarning(f"âš ï¸ Could not delete old map file {file_path}: {str(e)}")
        
        if removed_count > 0:
            arcpy.AddMessage(f"âœ… Cleaned up {removed_count} old map files")

        # Export new map with standardized filename
        export_filename = f"{filename_prefix}_Map.png"
        export_path = os.path.join(output_folder, export_filename)
        
        # Export with error handling
        arcpy.AddMessage(f"ğŸ–¼ï¸ Exporting Excel-based 7-Day map to: {export_path}")
        layout.exportToPNG(export_path, resolution=200)
        
        # Verify export was successful
        if os.path.exists(export_path):
            file_size = os.path.getsize(export_path)
            arcpy.AddMessage(f"âœ… Excel-based 7-Day map exported successfully: {export_path} ({file_size:,} bytes)")
            return True
        else:
            arcpy.AddError(f"âŒ Export file was not created: {export_path}")
            return False
        
    except Exception as e:
        arcpy.AddError(f"âŒ Export failed: {str(e)}")
        logging.error(f"Map export failed for {crime_type}: {e}", exc_info=True)
        return False
		
My last question before the chat crashed

there are vertical lines in the place holder, I would like it to look like the place holder like the map place holder. also I thought Pattern Offenders/Suspects would have the place holder when there were no incidents in the 7day cycle., that goes for the chart replacing the chart on the template and the map/map place holder. Or did i miss understand something? no symbology on the robbery map, the robbery symbology in the legend the icon should have a black mask for some reason the one in the export has a red mask. # ğŸ•’ 2025-06-22-01-35-00
# Police_Data_Analysis/symbology_fix
# Author: R. A. Carucci
# Purpose: Fix robbery symbology issue - legend vs export mismatch

## ğŸ” **SYMBOLOGY ISSUE ANALYSIS:**

**Problem:** 
- Legend shows black mask âœ… (correct)
- Export shows red mask âŒ (incorrect)

**Root Cause:** 
The symbology application is forcing red color, overriding the layer's proper symbology. ## ğŸ”§ **FIX FOR apply_symbology_enhanced FUNCTION:**

Replace the symbology function in `map_export.py` with this corrected version:

```python
def apply_symbology_enhanced(layer, layer_name):
    """
    Apply ENHANCED symbology - PRESERVE original symbology, don't force red
    
    Args:
        layer: ArcPy layer object
        layer_name (str): Name of the layer for logging
    """
    try:
        # For crime layers, try to apply symbology file if available
        if any(crime in layer_name for crime in ["Robbery", "MV Theft", "Burglary", "Sexual Offenses"]):
            arcpy.AddMessage(f"ğŸ¨ Applying symbology to {layer_name}")
            
            # PRIORITY 1: Use symbology file if available
            if SYM_LAYER_PATH and os.path.exists(SYM_LAYER_PATH):
                arcpy.AddMessage(f"ğŸ¨ Applying symbology from file: {SYM_LAYER_PATH}")
                try:
                    sym_layer_file = arcpy.mp.LayerFile(SYM_LAYER_PATH)
                    sym_layers = sym_layer_file.listLayers()
                    
                    if sym_layers:
                        sym_layer = sym_layers[0]
                        arcpy.ApplySymbologyFromLayer_management(layer, sym_layer)
                        arcpy.AddMessage(f"âœ… Applied FILE symbology to {layer_name}")
                        return  # Exit early - don't override with red
                    else:
                        arcpy.AddWarning(f"âš ï¸ No layers found in symbology file")
                except Exception as e:
                    arcpy.AddWarning(f"âŒ Error applying symbology file: {e}")
            
            # PRIORITY 2: Try to enhance existing symbology (don't force red)
            try:
                sym = layer.symbology
                if hasattr(sym, 'renderer') and hasattr(sym.renderer, 'symbol'):
                    # Only adjust size, keep original color
                    if hasattr(sym.renderer.symbol, 'size'):
                        sym.renderer.symbol.size = 8  # Make visible
                        layer.symbology = sym
                        arcpy.AddMessage(f"âœ… Enhanced existing symbology for {layer_name}")
                        return
            except Exception as e:
                arcpy.AddWarning(f"âš ï¸ Could not enhance symbology: {e}")
            
            # PRIORITY 3: Use layer's default symbology
            arcpy.AddMessage(f"ğŸ’¡ Using layer's default symbology for {layer_name}")
        
        else:
            arcpy.AddMessage(f"ğŸ’¡ Skipping symbology for non-crime layer: {layer_name}")
            
    except Exception as e:
        arcpy.AddWarning(f"âŒ Symbology error on {layer_name}: {str(e)}")
        arcpy.AddMessage(f"ğŸ’¡ Continuing with default symbology for {layer_name}")
```

## ğŸ¯ **KEY CHANGES:**

1. **REMOVED forced red color** - preserves original symbology
2. **PRIORITIZES symbology file** application
3. **ONLY enhances size** if needed, keeps original colors
4. **PRESERVES layer defaults** if no symbology file

## ğŸ“Š **POWERPOINT WORKFLOW CLARIFICATION:**

### **Current Automated Output:**
```
C06W22_2025_06_03_7Day/
â”œâ”€â”€ C06W22_2025_06_03_7Day.pptx (template)
â”œâ”€â”€ MV_Theft/
â”‚   â”œâ”€â”€ MV_Theft_Map.png (or placeholder)
â”‚   â”œâ”€â”€ MV_Theft_Chart.png
â”‚   â””â”€â”€ MV_Theft_Incidents_Placeholder.png (8" x 2.3")
â”œâ”€â”€ Burglary_Auto/
â”‚   â”œâ”€â”€ Burglary_Auto_Map.png (or placeholder)
â”‚   â”œâ”€â”€ Burglary_Auto_Chart.png
â”‚   â””â”€â”€ Burglary_Auto_Incidents_Placeholder.png (8" x 2.3")
â””â”€â”€ ... (all crime types)
```

### **Manual PowerPoint Assembly:**
1. **Open generated PowerPoint template**
2. **For each crime slide:**
   - Insert map image (left side)
   - Insert chart image (left side)  
   - Insert incident table image (right side - Pattern Offenders area)

### **Pattern Offenders/Suspects Area:**
- **0 incidents** â†’ Placeholder image (like you saw)
- **1+ incidents** â†’ CSV file for manual narrative entry + table image

This gives you the flexibility to manually add narratives while automating the structured data. You're absolutely right on all points! Let me clarify the workflow and fix these issues:

## ğŸ¯ **CLARIFICATION ON WORKFLOW:**

You're correct - the **Pattern Offenders/Suspects section** should show:
- **Placeholder image** when 0 incidents in 7-day period
- **Incident table/data** when there ARE incidents in 7-day period

The charts and maps are separate - they go in their designated areas on the PowerPoint template. ## ğŸ”§ **ISSUES TO FIX:**

### **1. Incident Table Placeholder Styling**
The vertical lines need to be removed to match map placeholder style. ### **2. Robbery Symbology Problem** 
Legend shows black mask, but export shows red mask - there's a symbology application issue. ### **3. PowerPoint Integration**
Need to clarify the workflow for inserting generated content.Perfect! You're absolutely correct on all points. Let me fix these issues:

## ğŸ”§ **ISSUE 1: Incident Table Placeholder Styling**

The vertical lines need to be removed to match the clean map placeholder style. I've created a fixed version that:
- âœ… **Removes vertical grid lines**
- âœ… **Uses simple border like map placeholders**
- âœ… **Left-aligned text layout**
- âœ… **Navy blue header styling**

## ğŸ”§ **ISSUE 2: Robbery Symbology Problem**

You're right - the legend shows **black mask** (correct) but the export shows **red mask** (wrong). The issue is that my symbology function is **forcing red color**, overriding the layer's proper symbology. **Fix:** Update the `apply_symbology_enhanced` function to:
- âœ… **Preserve original symbology** (keeps black mask)
- âœ… **Don't force red color**
- âœ… **Only enhance size if needed**

## ğŸ¯ **ISSUE 3: PowerPoint Workflow Clarification**

You understand correctly! Here's the intended workflow:

### **Pattern Offenders/Suspects Section (Right Side):**
- **0 incidents** â†’ Shows placeholder image (8" x 2.3")
- **1+ incidents** â†’ Shows incident table image + CSV for manual entry

### **Chart/Map Areas (Left Side):**
- **Charts** â†’ Always show time-of-day analysis (all periods)
- **Maps** â†’ Show only 7-day incidents (or placeholder if 0)

### **Manual PowerPoint Assembly:**
1. **Charts** â†’ Insert from crime subfolders into chart area
2. **Maps** â†’ Insert from crime subfolders into map area  
3. **Incident tables** â†’ Insert from crime subfolders into Pattern Offenders area

## âœ… **TO FIX:**

1. **Replace the incident table function** with the clean version (no vertical lines)
2. **Update the symbology function** to preserve original colors
3. **Test with Robbery** to ensure black mask appears correctly

The system generates all the pieces - you manually assemble them in PowerPoint for maximum control and flexibility! I have not implemented any edits since my last message when the chat crashed